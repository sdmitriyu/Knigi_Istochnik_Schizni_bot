2025-06-16 15:47:28,192 - main - DEBUG - Подключение роутеров
2025-06-16 15:47:28,225 - main - INFO - Запуск приложения
2025-06-16 15:47:28,226 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 15:47:28,228 - main - INFO - Инициализация базы данных
2025-06-16 15:47:28,229 - data.models - INFO - Начало инициализации базы данных
2025-06-16 15:47:28,230 - data.models - DEBUG - Создание таблиц
2025-06-16 15:47:28,231 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 15:47:28,233 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 15:47:28,235 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 15:47:28,237 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 15:47:28,239 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:47:28,240 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:47:28,241 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 15:47:28,243 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 15:47:28,244 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 15:47:28,246 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 15:47:28,247 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 15:47:28,248 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:47:28,249 - data.models - DEBUG - Создание таблицы order_statuses
2025-06-16 15:47:28,250 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 15:47:28,251 - data.models - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 15:47:28,251 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 15:47:28,252 - data.models - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 15:47:28,252 - data.models - DEBUG - Инициализация статусов заказа
2025-06-16 15:47:28,253 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 15:47:28,254 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 15:47:28,255 - data.models - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 15:47:28,256 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 15:47:28,258 - data.models - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 15:47:28,259 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 15:47:28,260 - data.models - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 15:47:28,261 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 15:47:28,261 - data.models - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 15:47:28,262 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 15:47:28,264 - data.models - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 15:47:28,264 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 15:47:28,265 - data.models - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 15:47:28,266 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 15:47:28,268 - data.models - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 15:47:28,268 - data.models - DEBUG - Создание администратора по умолчанию
2025-06-16 15:47:28,269 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:47:28,270 - data.models - DEBUG - Инициализация текстовых полей
2025-06-16 15:47:28,271 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:47:28,272 - data.models - DEBUG - Приветствие создано/обновлено
2025-06-16 15:47:28,273 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:47:28,274 - data.models - DEBUG - Текст галереи создан/обновлен
2025-06-16 15:47:28,274 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:47:28,275 - data.models - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 15:47:28,276 - data.models - INFO - Текстовые поля успешно инициализированы
2025-06-16 15:47:28,276 - data.models - DEBUG - Инициализация тестовых книг
2025-06-16 15:47:28,277 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 15:47:28,277 - data.models - DEBUG - Текущее количество книг в базе: 1
2025-06-16 15:47:28,278 - data.models - INFO - База данных успешно инициализирована
2025-06-16 15:47:28,278 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 15:47:28,629 - main - INFO - Запуск бота
2025-06-16 15:47:28,630 - aiogram.dispatcher - INFO - Start polling
2025-06-16 15:47:28,750 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 15:50:18,528 - main - DEBUG - Подключение роутеров
2025-06-16 15:50:18,536 - main - INFO - Запуск приложения
2025-06-16 15:50:18,537 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 15:50:18,539 - main - INFO - Инициализация базы данных
2025-06-16 15:50:18,540 - data.models - INFO - Начало инициализации базы данных
2025-06-16 15:50:18,541 - data.models - DEBUG - Создание таблиц
2025-06-16 15:50:18,541 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 15:50:18,543 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 15:50:18,544 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 15:50:18,546 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 15:50:18,547 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:50:18,548 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:50:18,549 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 15:50:18,554 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 15:50:18,558 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 15:50:18,562 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 15:50:18,569 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 15:50:18,573 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:50:18,577 - data.models - DEBUG - Создание таблицы order_statuses
2025-06-16 15:50:18,579 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 15:50:18,585 - data.models - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 15:50:18,587 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 15:50:18,590 - data.models - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 15:50:18,601 - data.models - DEBUG - Инициализация статусов заказа
2025-06-16 15:50:18,604 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 15:50:18,606 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 15:50:18,620 - data.models - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 15:50:18,622 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 15:50:18,644 - data.models - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 15:50:18,648 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 15:50:18,654 - data.models - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 15:50:18,660 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 15:50:18,667 - data.models - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 15:50:18,677 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 15:50:18,678 - data.models - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 15:50:18,679 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 15:50:18,681 - data.models - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 15:50:18,681 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 15:50:18,682 - data.models - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 15:50:18,683 - data.models - DEBUG - Создание администратора по умолчанию
2025-06-16 15:50:18,684 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:50:18,685 - data.models - DEBUG - Инициализация текстовых полей
2025-06-16 15:50:18,685 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:50:18,686 - data.models - DEBUG - Приветствие создано/обновлено
2025-06-16 15:50:18,687 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:50:18,688 - data.models - DEBUG - Текст галереи создан/обновлен
2025-06-16 15:50:18,689 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:50:18,690 - data.models - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 15:50:18,690 - data.models - INFO - Текстовые поля успешно инициализированы
2025-06-16 15:50:18,690 - data.models - DEBUG - Инициализация тестовых книг
2025-06-16 15:50:18,691 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 15:50:18,691 - data.models - DEBUG - Текущее количество книг в базе: 1
2025-06-16 15:50:18,692 - data.models - INFO - База данных успешно инициализирована
2025-06-16 15:50:18,692 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 15:50:19,085 - main - INFO - Запуск бота
2025-06-16 15:50:19,087 - aiogram.dispatcher - INFO - Start polling
2025-06-16 15:50:19,186 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 15:51:44,837 - main - DEBUG - Подключение роутеров
2025-06-16 15:51:44,848 - main - INFO - Запуск приложения
2025-06-16 15:51:44,849 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 15:51:44,850 - main - INFO - Инициализация базы данных
2025-06-16 15:51:44,852 - data.models - INFO - Начало инициализации базы данных
2025-06-16 15:51:44,852 - data.models - DEBUG - Создание таблиц
2025-06-16 15:51:44,853 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 15:51:44,854 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 15:51:44,855 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 15:51:44,856 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 15:51:44,858 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:51:44,858 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:51:44,859 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 15:51:44,860 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 15:51:44,861 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 15:51:44,862 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 15:51:44,863 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 15:51:44,864 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:51:44,865 - data.models - DEBUG - Создание таблицы order_statuses
2025-06-16 15:51:44,865 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 15:51:44,866 - data.models - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 15:51:44,866 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 15:51:44,867 - data.models - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 15:51:44,867 - data.models - DEBUG - Инициализация статусов заказа
2025-06-16 15:51:44,867 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 15:51:44,868 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 15:51:44,869 - data.models - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 15:51:44,870 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 15:51:44,871 - data.models - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 15:51:44,872 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 15:51:44,872 - data.models - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 15:51:44,874 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 15:51:44,875 - data.models - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 15:51:44,876 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 15:51:44,878 - data.models - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 15:51:44,878 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 15:51:44,879 - data.models - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 15:51:44,880 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 15:51:44,881 - data.models - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 15:51:44,881 - data.models - DEBUG - Создание администратора по умолчанию
2025-06-16 15:51:44,882 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:51:44,883 - data.models - DEBUG - Инициализация текстовых полей
2025-06-16 15:51:44,883 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:51:44,884 - data.models - DEBUG - Приветствие создано/обновлено
2025-06-16 15:51:44,885 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:51:44,886 - data.models - DEBUG - Текст галереи создан/обновлен
2025-06-16 15:51:44,905 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:51:44,911 - data.models - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 15:51:44,915 - data.models - INFO - Текстовые поля успешно инициализированы
2025-06-16 15:51:44,920 - data.models - DEBUG - Инициализация тестовых книг
2025-06-16 15:51:44,922 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 15:51:44,924 - data.models - DEBUG - Текущее количество книг в базе: 1
2025-06-16 15:51:44,926 - data.models - INFO - База данных успешно инициализирована
2025-06-16 15:51:44,930 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 15:51:45,422 - main - INFO - Запуск бота
2025-06-16 15:51:45,424 - aiogram.dispatcher - INFO - Start polling
2025-06-16 15:51:45,540 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 15:51:45,656 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:51:45,659 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 15:51:49,821 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:51:49,822 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 15:51:50,936 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:51:50,938 - aiogram.dispatcher - WARNING - Sleep for 1.250392 seconds and try again... (tryings = 1, bot id = 7420426900)
2025-06-16 15:51:55,335 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:51:55,337 - aiogram.dispatcher - WARNING - Sleep for 1.316647 seconds and try again... (tryings = 1, bot id = 7420426900)
2025-06-16 15:51:56,776 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:51:56,778 - aiogram.dispatcher - WARNING - Sleep for 1.428946 seconds and try again... (tryings = 2, bot id = 7420426900)
2025-06-16 15:52:01,344 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:01,347 - aiogram.dispatcher - WARNING - Sleep for 1.686432 seconds and try again... (tryings = 2, bot id = 7420426900)
2025-06-16 15:52:03,178 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:03,180 - aiogram.dispatcher - WARNING - Sleep for 1.895562 seconds and try again... (tryings = 3, bot id = 7420426900)
2025-06-16 15:52:03,437 - aiogram.dispatcher - INFO - Connection established (tryings = 3, bot id = 7420426900)
2025-06-16 15:52:03,439 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:52:03,441 - admin_state_book_handlers - DEBUG - Вход в обработчик start - Данные: {'user_id': 5069224643}
2025-06-16 15:52:04,093 - aiogram.event - INFO - Update id=708194487 is handled. Duration 656 ms by bot id=7420426900
2025-06-16 15:52:08,227 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:08,229 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 15:52:09,378 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:09,379 - aiogram.dispatcher - WARNING - Sleep for 2.547223 seconds and try again... (tryings = 4, bot id = 7420426900)
2025-06-16 15:52:09,789 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 15:52:09,791 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:52:09,793 - admin_state_book_handlers - DEBUG - Вход в обработчик manage_books - Данные: {'user_id': 5069224643}
2025-06-16 15:52:09,937 - aiogram.event - INFO - Update id=708194488 is handled. Duration 140 ms by bot id=7420426900
2025-06-16 15:52:12,699 - aiogram.dispatcher - INFO - Connection established (tryings = 5, bot id = 7420426900)
2025-06-16 15:52:12,704 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:52:12,713 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."author", "t1"."price", "t1"."description", "t1"."photo", "t1"."quantity" FROM "books" AS "t1"', [])
2025-06-16 15:52:13,576 - aiogram.event - INFO - Update id=708194489 is handled. Duration 875 ms by bot id=7420426900
2025-06-16 15:52:15,108 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:15,110 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 15:52:16,255 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:16,256 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 15:52:20,415 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:20,417 - aiogram.dispatcher - WARNING - Sleep for 1.049313 seconds and try again... (tryings = 1, bot id = 7420426900)
2025-06-16 15:52:20,938 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 15:52:20,945 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."author", "t1"."price", "t1"."description", "t1"."photo", "t1"."quantity" FROM "books" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:52:21,399 - aiogram.event - INFO - Update id=708194490 is handled. Duration 468 ms by bot id=7420426900
2025-06-16 15:52:21,580 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:21,581 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 15:52:25,468 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 15:52:25,698 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:25,699 - aiogram.dispatcher - WARNING - Sleep for 1.459553 seconds and try again... (tryings = 2, bot id = 7420426900)
2025-06-16 15:52:25,904 - aiogram.event - INFO - Update id=708194491 is handled. Duration 437 ms by bot id=7420426900
2025-06-16 15:52:27,302 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:27,303 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 15:52:31,180 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 15:52:31,183 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:52:31,337 - aiogram.event - INFO - Update id=708194492 is handled. Duration 156 ms by bot id=7420426900
2025-06-16 15:52:31,458 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:31,460 - aiogram.dispatcher - WARNING - Sleep for 1.921534 seconds and try again... (tryings = 3, bot id = 7420426900)
2025-06-16 15:52:33,551 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:33,553 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 15:52:37,696 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:37,697 - aiogram.dispatcher - WARNING - Sleep for 2.557352 seconds and try again... (tryings = 4, bot id = 7420426900)
2025-06-16 15:52:39,111 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 15:52:39,114 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:52:39,121 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 15:52:39,123 - aiogram.event - INFO - Update id=708194493 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 15:52:40,416 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:40,417 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 15:52:44,506 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 15:52:44,508 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:52:44,516 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 15:52:44,518 - aiogram.event - INFO - Update id=708194494 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 15:52:44,535 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:44,536 - aiogram.dispatcher - WARNING - Sleep for 3.214136 seconds and try again... (tryings = 5, bot id = 7420426900)
2025-06-16 15:52:46,337 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:52:46,514 - aiogram.event - INFO - Update id=708194495 is handled. Duration 172 ms by bot id=7420426900
2025-06-16 15:52:47,866 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:47,868 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 15:52:52,016 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:52,017 - aiogram.dispatcher - WARNING - Sleep for 4.171246 seconds and try again... (tryings = 6, bot id = 7420426900)
2025-06-16 15:52:52,777 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 15:52:52,782 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:52:52,801 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 15:52:52,803 - aiogram.event - INFO - Update id=708194496 is handled. Duration 31 ms by bot id=7420426900
2025-06-16 15:52:56,305 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:52:56,307 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 15:52:59,136 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 15:52:59,139 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:52:59,146 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 15:52:59,147 - aiogram.event - INFO - Update id=708194497 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 15:53:00,454 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:53:00,456 - aiogram.dispatcher - WARNING - Sleep for 4.957286 seconds and try again... (tryings = 7, bot id = 7420426900)
2025-06-16 15:53:04,857 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:53:04,864 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 15:53:04,866 - aiogram.event - INFO - Update id=708194498 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 15:53:05,585 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:53:05,587 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 15:53:07,710 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 15:53:07,713 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:53:07,719 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 15:53:07,720 - aiogram.event - INFO - Update id=708194499 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 15:53:09,736 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:53:09,738 - aiogram.dispatcher - WARNING - Sleep for 5.210825 seconds and try again... (tryings = 8, bot id = 7420426900)
2025-06-16 15:53:14,065 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:53:14,576 - aiogram.event - INFO - Update id=708194500 is handled. Duration 514 ms by bot id=7420426900
2025-06-16 15:53:15,056 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:53:15,058 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 15:53:19,174 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:53:19,176 - aiogram.dispatcher - WARNING - Sleep for 4.938494 seconds and try again... (tryings = 9, bot id = 7420426900)
2025-06-16 15:53:24,216 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:53:24,218 - aiogram.dispatcher - WARNING - Sleep for 1.317179 seconds and try again... (tryings = 1, bot id = 7420426900)
2025-06-16 15:53:28,661 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:53:28,662 - aiogram.dispatcher - WARNING - Sleep for 5.022394 seconds and try again... (tryings = 10, bot id = 7420426900)
2025-06-16 15:53:33,815 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:53:33,816 - aiogram.dispatcher - WARNING - Sleep for 1.730056 seconds and try again... (tryings = 2, bot id = 7420426900)
2025-06-16 15:53:38,747 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:53:38,749 - aiogram.dispatcher - WARNING - Sleep for 4.975010 seconds and try again... (tryings = 11, bot id = 7420426900)
2025-06-16 15:53:43,854 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:53:43,855 - aiogram.dispatcher - WARNING - Sleep for 2.308636 seconds and try again... (tryings = 3, bot id = 7420426900)
2025-06-16 15:53:49,295 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:53:49,297 - aiogram.dispatcher - WARNING - Sleep for 5.142363 seconds and try again... (tryings = 12, bot id = 7420426900)
2025-06-16 15:53:54,580 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:53:54,582 - aiogram.dispatcher - WARNING - Sleep for 3.016372 seconds and try again... (tryings = 4, bot id = 7420426900)
2025-06-16 15:53:57,779 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:53:57,781 - aiogram.dispatcher - WARNING - Sleep for 4.878414 seconds and try again... (tryings = 13, bot id = 7420426900)
2025-06-16 15:54:02,816 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:54:02,817 - aiogram.dispatcher - WARNING - Sleep for 3.923665 seconds and try again... (tryings = 5, bot id = 7420426900)
2025-06-16 15:54:06,896 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:54:06,898 - aiogram.dispatcher - WARNING - Sleep for 5.045151 seconds and try again... (tryings = 14, bot id = 7420426900)
2025-06-16 15:54:12,054 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:54:12,056 - aiogram.dispatcher - WARNING - Sleep for 4.946723 seconds and try again... (tryings = 6, bot id = 7420426900)
2025-06-16 15:54:17,133 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:54:17,134 - aiogram.dispatcher - WARNING - Sleep for 4.947460 seconds and try again... (tryings = 15, bot id = 7420426900)
2025-06-16 15:54:22,215 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:54:22,217 - aiogram.dispatcher - WARNING - Sleep for 4.762882 seconds and try again... (tryings = 7, bot id = 7420426900)
2025-06-16 15:54:27,135 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:54:27,137 - aiogram.dispatcher - WARNING - Sleep for 4.938784 seconds and try again... (tryings = 16, bot id = 7420426900)
2025-06-16 15:54:32,214 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:54:32,216 - aiogram.dispatcher - WARNING - Sleep for 4.840605 seconds and try again... (tryings = 8, bot id = 7420426900)
2025-06-16 15:54:37,179 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:54:37,181 - aiogram.dispatcher - WARNING - Sleep for 5.076060 seconds and try again... (tryings = 17, bot id = 7420426900)
2025-06-16 15:54:42,390 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:54:42,392 - aiogram.dispatcher - WARNING - Sleep for 4.947992 seconds and try again... (tryings = 9, bot id = 7420426900)
2025-06-16 15:54:47,595 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:54:47,597 - aiogram.dispatcher - WARNING - Sleep for 4.870552 seconds and try again... (tryings = 18, bot id = 7420426900)
2025-06-16 15:54:52,612 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:54:52,613 - aiogram.dispatcher - WARNING - Sleep for 4.855978 seconds and try again... (tryings = 10, bot id = 7420426900)
2025-06-16 15:54:57,653 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:54:57,655 - aiogram.dispatcher - WARNING - Sleep for 4.981786 seconds and try again... (tryings = 19, bot id = 7420426900)
2025-06-16 15:55:02,738 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:55:02,740 - aiogram.dispatcher - WARNING - Sleep for 5.089507 seconds and try again... (tryings = 11, bot id = 7420426900)
2025-06-16 15:55:07,996 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:55:07,998 - aiogram.dispatcher - WARNING - Sleep for 4.958366 seconds and try again... (tryings = 20, bot id = 7420426900)
2025-06-16 15:55:13,113 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 15:55:13,115 - aiogram.dispatcher - WARNING - Sleep for 5.147727 seconds and try again... (tryings = 12, bot id = 7420426900)
2025-06-16 15:55:21,690 - main - DEBUG - Подключение роутеров
2025-06-16 15:55:21,699 - main - INFO - Запуск приложения
2025-06-16 15:55:21,700 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 15:55:21,701 - main - INFO - Инициализация базы данных
2025-06-16 15:55:21,703 - data.models - INFO - Начало инициализации базы данных
2025-06-16 15:55:21,703 - data.models - DEBUG - Создание таблиц
2025-06-16 15:55:21,704 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 15:55:21,705 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 15:55:21,706 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 15:55:21,708 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 15:55:21,709 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:55:21,710 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:55:21,711 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 15:55:21,712 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 15:55:21,713 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 15:55:21,714 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 15:55:21,714 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 15:55:21,715 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:55:21,716 - data.models - DEBUG - Создание таблицы order_statuses
2025-06-16 15:55:21,716 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 15:55:21,717 - data.models - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 15:55:21,717 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 15:55:21,718 - data.models - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 15:55:21,718 - data.models - DEBUG - Инициализация статусов заказа
2025-06-16 15:55:21,718 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 15:55:21,719 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 15:55:21,720 - data.models - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 15:55:21,720 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 15:55:21,721 - data.models - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 15:55:21,722 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 15:55:21,723 - data.models - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 15:55:21,724 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 15:55:21,725 - data.models - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 15:55:21,725 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 15:55:21,726 - data.models - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 15:55:21,727 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 15:55:21,728 - data.models - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 15:55:21,729 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 15:55:21,729 - data.models - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 15:55:21,730 - data.models - DEBUG - Создание администратора по умолчанию
2025-06-16 15:55:21,730 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:55:21,732 - data.models - DEBUG - Инициализация текстовых полей
2025-06-16 15:55:21,732 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:55:21,733 - data.models - DEBUG - Приветствие создано/обновлено
2025-06-16 15:55:21,734 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:55:21,734 - data.models - DEBUG - Текст галереи создан/обновлен
2025-06-16 15:55:21,735 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:55:21,736 - data.models - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 15:55:21,736 - data.models - INFO - Текстовые поля успешно инициализированы
2025-06-16 15:55:21,736 - data.models - DEBUG - Инициализация тестовых книг
2025-06-16 15:55:21,737 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 15:55:21,738 - data.models - DEBUG - Текущее количество книг в базе: 1
2025-06-16 15:55:21,738 - data.models - INFO - База данных успешно инициализирована
2025-06-16 15:55:21,739 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 15:55:22,225 - main - INFO - Запуск бота
2025-06-16 15:55:22,228 - aiogram.dispatcher - INFO - Start polling
2025-06-16 15:55:22,336 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 15:56:00,776 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:56:01,390 - aiogram.event - INFO - Update id=708194501 is handled. Duration 610 ms by bot id=7420426900
2025-06-16 15:56:03,987 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:56:03,994 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 15:56:03,996 - aiogram.event - INFO - Update id=708194502 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 15:56:08,374 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:56:08,381 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 15:56:08,382 - aiogram.event - INFO - Update id=708194503 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 15:56:10,711 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:56:10,721 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 15:56:10,723 - aiogram.event - INFO - Update id=708194504 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 15:59:28,929 - main - DEBUG - Подключение роутеров
2025-06-16 15:59:28,938 - main - INFO - Запуск приложения
2025-06-16 15:59:28,939 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 15:59:28,940 - main - INFO - Инициализация базы данных
2025-06-16 15:59:28,941 - data.models - INFO - Начало инициализации базы данных
2025-06-16 15:59:28,942 - data.models - DEBUG - Создание таблиц
2025-06-16 15:59:28,943 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 15:59:28,944 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 15:59:28,945 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 15:59:28,946 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 15:59:28,947 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:59:28,947 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:59:28,948 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 15:59:28,949 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 15:59:28,950 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 15:59:28,952 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 15:59:28,953 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 15:59:28,954 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 15:59:28,954 - data.models - DEBUG - Создание таблицы order_statuses
2025-06-16 15:59:28,955 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 15:59:28,955 - data.models - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 15:59:28,956 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 15:59:28,956 - data.models - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 15:59:28,957 - data.models - DEBUG - Инициализация статусов заказа
2025-06-16 15:59:28,957 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 15:59:28,958 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 15:59:28,959 - data.models - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 15:59:28,960 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 15:59:28,960 - data.models - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 15:59:28,962 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 15:59:28,963 - data.models - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 15:59:28,964 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 15:59:28,965 - data.models - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 15:59:28,966 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 15:59:28,967 - data.models - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 15:59:28,968 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 15:59:28,969 - data.models - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 15:59:28,969 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 15:59:28,970 - data.models - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 15:59:28,971 - data.models - DEBUG - Создание администратора по умолчанию
2025-06-16 15:59:28,971 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:59:28,973 - data.models - DEBUG - Инициализация текстовых полей
2025-06-16 15:59:28,974 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:59:28,975 - data.models - DEBUG - Приветствие создано/обновлено
2025-06-16 15:59:28,975 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:59:28,976 - data.models - DEBUG - Текст галереи создан/обновлен
2025-06-16 15:59:28,977 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 15:59:28,978 - data.models - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 15:59:28,978 - data.models - INFO - Текстовые поля успешно инициализированы
2025-06-16 15:59:28,978 - data.models - DEBUG - Инициализация тестовых книг
2025-06-16 15:59:28,979 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 15:59:28,980 - data.models - DEBUG - Текущее количество книг в базе: 1
2025-06-16 15:59:28,980 - data.models - INFO - База данных успешно инициализирована
2025-06-16 15:59:28,981 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 15:59:29,498 - main - INFO - Запуск бота
2025-06-16 15:59:29,501 - aiogram.dispatcher - INFO - Start polling
2025-06-16 15:59:29,657 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 15:59:38,054 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:59:38,062 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 15:59:38,066 - aiogram.event - INFO - Update id=708194505 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 15:59:41,264 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:59:41,282 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 15:59:41,286 - aiogram.event - INFO - Update id=708194506 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 15:59:50,506 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:59:50,516 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 15:59:50,518 - aiogram.event - INFO - Update id=708194507 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 15:59:52,980 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:59:53,610 - aiogram.event - INFO - Update id=708194508 is handled. Duration 625 ms by bot id=7420426900
2025-06-16 15:59:56,093 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:59:56,097 - admin_state_book_handlers - DEBUG - Вход в обработчик manage_books - Данные: {'user_id': 5069224643}
2025-06-16 15:59:56,329 - aiogram.event - INFO - Update id=708194509 is handled. Duration 233 ms by bot id=7420426900
2025-06-16 15:59:59,209 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 15:59:59,212 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."author", "t1"."price", "t1"."description", "t1"."photo", "t1"."quantity" FROM "books" AS "t1"', [])
2025-06-16 15:59:59,728 - aiogram.event - INFO - Update id=708194510 is handled. Duration 516 ms by bot id=7420426900
2025-06-16 16:00:02,869 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."author", "t1"."price", "t1"."description", "t1"."photo", "t1"."quantity" FROM "books" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:00:03,169 - aiogram.event - INFO - Update id=708194511 is handled. Duration 297 ms by bot id=7420426900
2025-06-16 16:00:05,307 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."author", "t1"."price", "t1"."description", "t1"."photo", "t1"."quantity" FROM "books" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:00:05,624 - aiogram.event - INFO - Update id=708194512 is handled. Duration 312 ms by bot id=7420426900
2025-06-16 16:00:12,661 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:00:12,678 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."author", "t1"."price", "t1"."description", "t1"."photo", "t1"."quantity" FROM "books" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:00:12,680 - data.models - DEBUG - Сохранение книги: name=Великая борьба., author=Елена Уайт, price=321.0, quantity=3
2025-06-16 16:00:12,682 - data.models - DEBUG - Начало сохранения Books с параметрами: args=(), kwargs={}
2025-06-16 16:00:12,683 - data.models - DEBUG - Валидация книги: name=Великая борьба., author=Елена Уайт, price=321.0, quantity=3
2025-06-16 16:00:12,685 - peewee - DEBUG - ('UPDATE "books" SET "name" = ?, "author" = ?, "price" = ?, "description" = ?, "photo" = ?, "quantity" = ? WHERE ("books"."id" = ?)', ['Великая борьба.', 'Елена Уайт', 321.0, 'В книге описывается борьба между Богом и сатаной в разрезе истории от библейских времён и до второго пришествия Христа.', 'AgACAgIAAxkBAAIB_GhP9Iv4QaBK5lhqtzvtxaJRBZM_AAIj8zEboh2ASqRU4-5YtQddAQADAgADeQADNgQ', 3, 1])
2025-06-16 16:00:12,693 - data.models - INFO - Успешно сохранена запись Books с id 1
2025-06-16 16:00:12,907 - aiogram.event - INFO - Update id=708194513 is handled. Duration 250 ms by bot id=7420426900
2025-06-16 16:00:23,690 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:00:23,906 - aiogram.event - INFO - Update id=708194514 is handled. Duration 218 ms by bot id=7420426900
2025-06-16 16:00:27,040 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:00:27,298 - aiogram.event - INFO - Update id=708194515 is handled. Duration 250 ms by bot id=7420426900
2025-06-16 16:00:29,448 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:00:29,454 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."telegram_id", "t1"."fio", "t1"."addres", "t1"."phone", "t1"."book_id", "t1"."book_info", "t1"."status_id", "t1"."created_at", "t1"."updated_at" FROM "order" AS "t1" ORDER BY "t1"."id" DESC', [])
2025-06-16 16:00:29,455 - aiogram.event - INFO - Update id=708194516 is not handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:00:29,456 - aiogram.event - ERROR - Cause exception while process update id=708194516 by bot id=7420426900
OperationalError: no such column: t1.status_id
Traceback (most recent call last):
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3322, in execute_sql
    cursor.execute(sql, params or ())
sqlite3.OperationalError: no such column: t1.status_id

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dmitriy\AppData\Local\Programs\Python\Python311\Lib\contextlib.py", line 222, in __aexit__
    await self.gen.athrow(typ, value, traceback)
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\fsm\storage\memory.py", line 56, in lock
    yield
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 41, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 156, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 128, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 123, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 148, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\admin\state_book_handlers.py", line 211, in view_orders
    if not orders:
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 2137, in __len__
    self._ensure_execution()
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 2119, in _ensure_execution
    self.execute()
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 2036, in inner
    return method(self, database, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 2107, in execute
    return self._execute(database)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 2280, in _execute
    cursor = database.execute(self)
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3330, in execute
    return self.execute_sql(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3320, in execute_sql
    with __exception_wrapper__:
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3088, in __exit__
    reraise(new_type, new_type(exc_value, *exc_args), traceback)
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 196, in reraise
    raise value.with_traceback(tb)
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3322, in execute_sql
    cursor.execute(sql, params or ())
peewee.OperationalError: no such column: t1.status_id
2025-06-16 16:00:31,788 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:00:31,981 - aiogram.event - INFO - Update id=708194517 is handled. Duration 187 ms by bot id=7420426900
2025-06-16 16:00:33,960 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:00:33,970 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:00:33,972 - aiogram.event - INFO - Update id=708194518 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:00:38,134 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:00:38,287 - aiogram.event - INFO - Update id=708194519 is handled. Duration 156 ms by bot id=7420426900
2025-06-16 16:00:42,703 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:00:42,936 - aiogram.event - INFO - Update id=708194520 is handled. Duration 235 ms by bot id=7420426900
2025-06-16 16:00:43,047 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:00:43,286 - aiogram.event - INFO - Update id=708194521 is handled. Duration 250 ms by bot id=7420426900
2025-06-16 16:00:50,388 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:00:50,401 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:00:50,403 - aiogram.event - INFO - Update id=708194522 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 16:00:53,429 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:00:53,436 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:00:53,437 - aiogram.event - INFO - Update id=708194523 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:05:54,075 - data.models - INFO - Начало инициализации базы данных
2025-06-16 16:05:54,075 - data.models - DEBUG - Создание таблиц
2025-06-16 16:05:54,076 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 16:05:54,076 - data.models - ERROR - Ошибка при инициализации базы данных: Error, database must be initialized before opening a connection.
2025-06-16 16:05:54,080 - data.models - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3321, in execute_sql
    cursor = self.cursor()
             ^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3311, in cursor
    self.connect()
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3254, in connect
    raise InterfaceError('Error, database must be initialized '
peewee.InterfaceError: Error, database must be initialized before opening a connection.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\data\models.py", line 285, in initialize_db
    db.create_tables([
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3508, in create_tables
    model.create_table(**options)
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 7083, in create_table
    cls._schema.create_all(safe, **options)
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 6176, in create_all
    self.create_table(safe, **table_options)
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 6032, in create_table
    self.database.execute(self._create_table(safe=safe, **options))
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3330, in execute
    return self.execute_sql(sql, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3320, in execute_sql
    with __exception_wrapper__:
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3088, in __exit__
    reraise(new_type, new_type(exc_value, *exc_args), traceback)
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 196, in reraise
    raise value.with_traceback(tb)
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3321, in execute_sql
    cursor = self.cursor()
             ^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3311, in cursor
    self.connect()
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\.venv\Lib\site-packages\peewee.py", line 3254, in connect
    raise InterfaceError('Error, database must be initialized '
peewee.InterfaceError: Error, database must be initialized before opening a connection.

2025-06-16 16:14:03,060 - main - DEBUG - Подключение роутеров
2025-06-16 16:14:03,071 - main - INFO - Запуск приложения
2025-06-16 16:14:03,073 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 16:14:03,074 - main - INFO - Инициализация базы данных
2025-06-16 16:14:03,075 - main - INFO - Начало инициализации базы данных
2025-06-16 16:14:03,076 - main - DEBUG - Создание таблиц
2025-06-16 16:14:03,078 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 16:14:03,080 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 16:14:03,081 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 16:14:03,083 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 16:14:03,084 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:14:03,085 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:14:03,086 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 16:14:03,087 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 16:14:03,089 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 16:14:03,090 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 16:14:03,091 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 16:14:03,092 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:14:03,092 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 16:14:03,094 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 16:14:03,094 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 16:14:03,096 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 16:14:03,097 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 16:14:03,098 - main - DEBUG - Инициализация статусов заказа
2025-06-16 16:14:03,099 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 16:14:03,100 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 16:14:03,101 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 16:14:03,102 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 16:14:03,102 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 16:14:03,104 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 16:14:03,104 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 16:14:03,106 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 16:14:03,107 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 16:14:03,108 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 16:14:03,109 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 16:14:03,111 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 16:14:03,112 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 16:14:03,113 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 16:14:03,114 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 16:14:03,115 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 16:14:03,117 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:03,118 - main - DEBUG - Инициализация текстовых полей
2025-06-16 16:14:03,119 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:14:03,120 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 16:14:03,122 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:14:03,123 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 16:14:03,125 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:14:03,137 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 16:14:03,142 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 16:14:03,174 - main - DEBUG - Инициализация тестовых книг
2025-06-16 16:14:03,203 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 16:14:03,204 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 16:14:03,205 - main - INFO - База данных успешно инициализирована
2025-06-16 16:14:03,206 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 16:14:05,285 - main - INFO - Запуск бота
2025-06-16 16:14:05,288 - aiogram.dispatcher - INFO - Start polling
2025-06-16 16:14:05,800 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 16:14:06,312 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:06,314 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:06,316 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:06,317 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:06,330 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:14:06,332 - aiogram.event - INFO - Update id=708194527 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 16:14:06,785 - aiogram.event - INFO - Update id=708194526 is handled. Duration 468 ms by bot id=7420426900
2025-06-16 16:14:06,786 - aiogram.event - INFO - Update id=708194524 is handled. Duration 484 ms by bot id=7420426900
2025-06-16 16:14:06,793 - aiogram.event - INFO - Update id=708194525 is handled. Duration 484 ms by bot id=7420426900
2025-06-16 16:14:18,036 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:18,194 - aiogram.event - INFO - Update id=708194528 is handled. Duration 171 ms by bot id=7420426900
2025-06-16 16:14:22,285 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:22,293 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:14:22,295 - aiogram.event - INFO - Update id=708194529 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 16:14:25,078 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:25,098 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:14:25,102 - aiogram.event - INFO - Update id=708194530 is handled. Duration 32 ms by bot id=7420426900
2025-06-16 16:14:27,286 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:27,307 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:14:27,311 - aiogram.event - INFO - Update id=708194531 is handled. Duration 31 ms by bot id=7420426900
2025-06-16 16:14:30,165 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:30,317 - aiogram.event - INFO - Update id=708194532 is handled. Duration 140 ms by bot id=7420426900
2025-06-16 16:14:37,513 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:37,714 - aiogram.event - INFO - Update id=708194533 is handled. Duration 202 ms by bot id=7420426900
2025-06-16 16:14:39,593 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:39,600 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:14:39,602 - aiogram.event - INFO - Update id=708194534 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 16:14:46,323 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:46,330 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:14:46,332 - aiogram.event - INFO - Update id=708194535 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:14:50,435 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:14:50,644 - aiogram.event - INFO - Update id=708194536 is handled. Duration 203 ms by bot id=7420426900
2025-06-16 16:21:20,807 - main - DEBUG - Подключение роутеров
2025-06-16 16:21:20,815 - main - INFO - Запуск приложения
2025-06-16 16:21:20,816 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 16:21:20,818 - main - INFO - Инициализация базы данных
2025-06-16 16:21:20,819 - main - INFO - Начало инициализации базы данных
2025-06-16 16:21:20,820 - main - DEBUG - Создание таблиц
2025-06-16 16:21:20,821 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 16:21:20,823 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 16:21:20,824 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 16:21:20,825 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 16:21:20,826 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:21:20,827 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:21:20,828 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 16:21:20,828 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 16:21:20,829 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 16:21:20,830 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 16:21:20,831 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 16:21:20,832 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:21:20,833 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 16:21:20,834 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 16:21:20,835 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 16:21:20,836 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 16:21:20,836 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 16:21:20,837 - main - DEBUG - Инициализация статусов заказа
2025-06-16 16:21:20,838 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 16:21:20,839 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 16:21:20,840 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 16:21:20,842 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 16:21:20,842 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 16:21:20,844 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 16:21:20,845 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 16:21:20,846 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 16:21:20,847 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 16:21:20,848 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 16:21:20,850 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 16:21:20,851 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 16:21:20,852 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 16:21:20,853 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 16:21:20,854 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 16:21:20,855 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 16:21:20,856 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:21:20,858 - main - DEBUG - Инициализация текстовых полей
2025-06-16 16:21:20,859 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:21:20,860 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 16:21:20,861 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:21:20,862 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 16:21:20,863 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:21:20,864 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 16:21:20,865 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 16:21:20,866 - main - DEBUG - Инициализация тестовых книг
2025-06-16 16:21:20,868 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 16:21:20,869 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 16:21:20,870 - main - INFO - База данных успешно инициализирована
2025-06-16 16:21:20,871 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 16:21:23,329 - main - INFO - Запуск бота
2025-06-16 16:21:23,332 - aiogram.dispatcher - INFO - Start polling
2025-06-16 16:21:24,126 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 16:21:38,310 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:21:38,703 - aiogram.event - INFO - Update id=708194537 is handled. Duration 389 ms by bot id=7420426900
2025-06-16 16:21:42,628 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:21:42,637 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:21:42,639 - aiogram.event - INFO - Update id=708194538 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 16:21:46,040 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:21:46,047 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:21:46,049 - aiogram.event - INFO - Update id=708194539 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:21:49,107 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:21:49,113 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:21:49,115 - aiogram.event - INFO - Update id=708194540 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 16:21:52,269 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:21:52,506 - aiogram.event - INFO - Update id=708194541 is handled. Duration 250 ms by bot id=7420426900
2025-06-16 16:21:56,006 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:21:56,147 - aiogram.event - INFO - Update id=708194542 is handled. Duration 139 ms by bot id=7420426900
2025-06-16 16:21:58,268 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:21:58,277 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:21:58,280 - aiogram.event - INFO - Update id=708194543 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 16:26:49,080 - main - DEBUG - Подключение роутеров
2025-06-16 16:26:49,089 - main - INFO - Запуск приложения
2025-06-16 16:26:49,090 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 16:26:49,091 - main - INFO - Инициализация базы данных
2025-06-16 16:26:49,092 - main - INFO - Начало инициализации базы данных
2025-06-16 16:26:49,093 - main - DEBUG - Создание таблиц
2025-06-16 16:26:49,095 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 16:26:49,096 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 16:26:49,098 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 16:26:49,099 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 16:26:49,099 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:26:49,100 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:26:49,101 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 16:26:49,102 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 16:26:49,103 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 16:26:49,104 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 16:26:49,105 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 16:26:49,106 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:26:49,106 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 16:26:49,108 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 16:26:49,108 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 16:26:49,109 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 16:26:49,110 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 16:26:49,111 - main - DEBUG - Инициализация статусов заказа
2025-06-16 16:26:49,112 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 16:26:49,114 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 16:26:49,115 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 16:26:49,117 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 16:26:49,117 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 16:26:49,119 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 16:26:49,120 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 16:26:49,121 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 16:26:49,122 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 16:26:49,123 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 16:26:49,124 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 16:26:49,126 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 16:26:49,126 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 16:26:49,128 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 16:26:49,129 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 16:26:49,131 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 16:26:49,133 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:26:49,135 - main - DEBUG - Инициализация текстовых полей
2025-06-16 16:26:49,138 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:26:49,145 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 16:26:49,172 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:26:49,181 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 16:26:49,195 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:26:49,209 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 16:26:49,212 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 16:26:49,216 - main - DEBUG - Инициализация тестовых книг
2025-06-16 16:26:49,221 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 16:26:49,222 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 16:26:49,223 - main - INFO - База данных успешно инициализирована
2025-06-16 16:26:49,224 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 16:26:51,356 - main - INFO - Запуск бота
2025-06-16 16:26:51,359 - aiogram.dispatcher - INFO - Start polling
2025-06-16 16:26:52,153 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 16:26:57,330 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:26:57,337 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:26:57,340 - aiogram.event - INFO - Update id=708194544 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 16:26:58,459 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:26:58,466 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:26:58,468 - aiogram.event - INFO - Update id=708194545 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:27:00,123 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:27:00,751 - aiogram.event - INFO - Update id=708194546 is handled. Duration 625 ms by bot id=7420426900
2025-06-16 16:27:06,074 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:27:06,252 - aiogram.event - INFO - Update id=708194547 is handled. Duration 172 ms by bot id=7420426900
2025-06-16 16:27:09,783 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:27:09,790 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:27:09,791 - aiogram.event - INFO - Update id=708194548 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 16:27:12,467 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:27:12,476 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:27:12,479 - aiogram.event - INFO - Update id=708194549 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 16:27:14,584 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:27:14,591 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:27:14,593 - aiogram.event - INFO - Update id=708194550 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:30:54,033 - main - DEBUG - Подключение роутеров
2025-06-16 16:30:54,043 - main - INFO - Запуск приложения
2025-06-16 16:30:54,044 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 16:30:54,045 - main - INFO - Инициализация базы данных
2025-06-16 16:30:54,046 - main - INFO - Начало инициализации базы данных
2025-06-16 16:30:54,047 - main - DEBUG - Создание таблиц
2025-06-16 16:30:54,049 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 16:30:54,051 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 16:30:54,053 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 16:30:54,054 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 16:30:54,055 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:30:54,056 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:30:54,057 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 16:30:54,059 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 16:30:54,060 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 16:30:54,062 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 16:30:54,062 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 16:30:54,063 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:30:54,064 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 16:30:54,065 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 16:30:54,066 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 16:30:54,067 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 16:30:54,068 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 16:30:54,069 - main - DEBUG - Инициализация статусов заказа
2025-06-16 16:30:54,070 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 16:30:54,071 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 16:30:54,071 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 16:30:54,073 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 16:30:54,074 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 16:30:54,075 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 16:30:54,076 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 16:30:54,077 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 16:30:54,078 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 16:30:54,080 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 16:30:54,081 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 16:30:54,082 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 16:30:54,083 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 16:30:54,084 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 16:30:54,085 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 16:30:54,086 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 16:30:54,087 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:30:54,088 - main - DEBUG - Инициализация текстовых полей
2025-06-16 16:30:54,090 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:30:54,090 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 16:30:54,091 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:30:54,092 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 16:30:54,093 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:30:54,094 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 16:30:54,096 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 16:30:54,097 - main - DEBUG - Инициализация тестовых книг
2025-06-16 16:30:54,098 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 16:30:54,099 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 16:30:54,100 - main - INFO - База данных успешно инициализирована
2025-06-16 16:30:54,101 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 16:30:57,089 - main - INFO - Запуск бота
2025-06-16 16:30:57,090 - aiogram.dispatcher - INFO - Start polling
2025-06-16 16:30:57,194 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 16:30:57,293 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:30:57,295 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 16:31:01,497 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:01,498 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 16:31:02,634 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:02,636 - aiogram.dispatcher - WARNING - Sleep for 1.391071 seconds and try again... (tryings = 1, bot id = 7420426900)
2025-06-16 16:31:07,297 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:07,299 - aiogram.dispatcher - WARNING - Sleep for 1.490606 seconds and try again... (tryings = 1, bot id = 7420426900)
2025-06-16 16:31:08,697 - aiogram.dispatcher - INFO - Connection established (tryings = 2, bot id = 7420426900)
2025-06-16 16:31:08,700 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:31:08,708 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:31:08,710 - aiogram.event - INFO - Update id=708194551 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 16:31:08,938 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:08,940 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 16:31:11,267 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 16:31:11,272 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:31:11,284 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:31:11,285 - aiogram.event - INFO - Update id=708194552 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:31:12,903 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:31:12,911 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:31:12,912 - aiogram.event - INFO - Update id=708194553 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 16:31:13,096 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:13,098 - aiogram.dispatcher - WARNING - Sleep for 2.008383 seconds and try again... (tryings = 2, bot id = 7420426900)
2025-06-16 16:31:14,656 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:31:14,663 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:31:14,664 - aiogram.event - INFO - Update id=708194554 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 16:31:15,215 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:15,217 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 16:31:19,342 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:19,344 - aiogram.dispatcher - WARNING - Sleep for 2.721800 seconds and try again... (tryings = 3, bot id = 7420426900)
2025-06-16 16:31:19,738 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 16:31:19,742 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:31:20,137 - aiogram.event - INFO - Update id=708194555 is handled. Duration 391 ms by bot id=7420426900
2025-06-16 16:31:22,177 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:22,178 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 16:31:23,697 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 16:31:23,700 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:31:23,702 - admin_state_book_handlers - DEBUG - Вход в обработчик manage_books - Данные: {'user_id': 5069224643}
2025-06-16 16:31:23,860 - aiogram.event - INFO - Update id=708194556 is handled. Duration 157 ms by bot id=7420426900
2025-06-16 16:31:25,457 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:31:25,462 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."author", "t1"."price", "t1"."description", "t1"."photo", "t1"."quantity" FROM "books" AS "t1"', [])
2025-06-16 16:31:26,034 - aiogram.event - INFO - Update id=708194557 is handled. Duration 578 ms by bot id=7420426900
2025-06-16 16:31:26,296 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:26,298 - aiogram.dispatcher - WARNING - Sleep for 3.388139 seconds and try again... (tryings = 4, bot id = 7420426900)
2025-06-16 16:31:29,857 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:29,859 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 16:31:33,990 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:33,992 - aiogram.dispatcher - WARNING - Sleep for 4.480172 seconds and try again... (tryings = 5, bot id = 7420426900)
2025-06-16 16:31:35,057 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 16:31:35,061 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."author", "t1"."price", "t1"."description", "t1"."photo", "t1"."quantity" FROM "books" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:31:35,683 - aiogram.event - INFO - Update id=708194558 is handled. Duration 625 ms by bot id=7420426900
2025-06-16 16:31:37,864 - aiogram.event - INFO - Update id=708194559 is handled. Duration 358 ms by bot id=7420426900
2025-06-16 16:31:38,615 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:38,616 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 16:31:42,777 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:42,778 - aiogram.dispatcher - WARNING - Sleep for 4.958646 seconds and try again... (tryings = 6, bot id = 7420426900)
2025-06-16 16:31:43,027 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 16:31:43,029 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:31:43,215 - aiogram.event - INFO - Update id=708194560 is handled. Duration 187 ms by bot id=7420426900
2025-06-16 16:31:47,897 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:47,899 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 16:31:48,536 - aiogram.dispatcher - INFO - Connection established (tryings = 7, bot id = 7420426900)
2025-06-16 16:31:48,539 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:31:49,087 - aiogram.event - INFO - Update id=708194561 is handled. Duration 546 ms by bot id=7420426900
2025-06-16 16:31:50,817 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 7420426900)
2025-06-16 16:31:50,820 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:31:50,827 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:31:50,829 - aiogram.event - INFO - Update id=708194562 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:31:52,037 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:52,039 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 16:31:52,058 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:31:52,070 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:31:52,072 - aiogram.event - INFO - Update id=708194563 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 16:31:53,176 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:53,178 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 16:31:57,334 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:57,335 - aiogram.dispatcher - WARNING - Sleep for 1.293549 seconds and try again... (tryings = 1, bot id = 7420426900)
2025-06-16 16:31:58,777 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:31:58,778 - aiogram.dispatcher - WARNING - Sleep for 1.165105 seconds and try again... (tryings = 1, bot id = 7420426900)
2025-06-16 16:32:03,085 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:03,087 - aiogram.dispatcher - WARNING - Sleep for 1.888760 seconds and try again... (tryings = 2, bot id = 7420426900)
2025-06-16 16:32:05,117 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:05,119 - aiogram.dispatcher - WARNING - Sleep for 1.489631 seconds and try again... (tryings = 2, bot id = 7420426900)
2025-06-16 16:32:09,705 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:09,707 - aiogram.dispatcher - WARNING - Sleep for 2.220196 seconds and try again... (tryings = 3, bot id = 7420426900)
2025-06-16 16:32:12,110 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:12,111 - aiogram.dispatcher - WARNING - Sleep for 2.047683 seconds and try again... (tryings = 3, bot id = 7420426900)
2025-06-16 16:32:17,305 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:17,306 - aiogram.dispatcher - WARNING - Sleep for 2.846235 seconds and try again... (tryings = 4, bot id = 7420426900)
2025-06-16 16:32:20,335 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:20,336 - aiogram.dispatcher - WARNING - Sleep for 2.591592 seconds and try again... (tryings = 4, bot id = 7420426900)
2025-06-16 16:32:26,109 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:26,111 - aiogram.dispatcher - WARNING - Sleep for 3.715565 seconds and try again... (tryings = 5, bot id = 7420426900)
2025-06-16 16:32:29,989 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:29,990 - aiogram.dispatcher - WARNING - Sleep for 3.407536 seconds and try again... (tryings = 5, bot id = 7420426900)
2025-06-16 16:32:33,550 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:33,552 - aiogram.dispatcher - WARNING - Sleep for 4.934850 seconds and try again... (tryings = 6, bot id = 7420426900)
2025-06-16 16:32:38,696 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:38,697 - aiogram.dispatcher - WARNING - Sleep for 4.442124 seconds and try again... (tryings = 6, bot id = 7420426900)
2025-06-16 16:32:43,692 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:43,694 - aiogram.dispatcher - WARNING - Sleep for 4.943276 seconds and try again... (tryings = 7, bot id = 7420426900)
2025-06-16 16:32:48,774 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:48,776 - aiogram.dispatcher - WARNING - Sleep for 5.124849 seconds and try again... (tryings = 7, bot id = 7420426900)
2025-06-16 16:32:54,214 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:54,216 - aiogram.dispatcher - WARNING - Sleep for 4.932039 seconds and try again... (tryings = 8, bot id = 7420426900)
2025-06-16 16:32:59,304 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:32:59,306 - aiogram.dispatcher - WARNING - Sleep for 4.929314 seconds and try again... (tryings = 8, bot id = 7420426900)
2025-06-16 16:33:04,349 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:33:04,350 - aiogram.dispatcher - WARNING - Sleep for 4.918095 seconds and try again... (tryings = 9, bot id = 7420426900)
2025-06-16 16:33:09,771 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:33:09,772 - aiogram.dispatcher - WARNING - Sleep for 4.970055 seconds and try again... (tryings = 9, bot id = 7420426900)
2025-06-16 16:33:15,507 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:33:15,508 - aiogram.dispatcher - WARNING - Sleep for 4.947365 seconds and try again... (tryings = 10, bot id = 7420426900)
2025-06-16 16:33:20,592 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:33:20,594 - aiogram.dispatcher - WARNING - Sleep for 4.870683 seconds and try again... (tryings = 10, bot id = 7420426900)
2025-06-16 16:33:25,590 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:33:25,591 - aiogram.dispatcher - WARNING - Sleep for 5.063771 seconds and try again... (tryings = 11, bot id = 7420426900)
2025-06-16 16:33:30,813 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:33:30,814 - aiogram.dispatcher - WARNING - Sleep for 4.865318 seconds and try again... (tryings = 11, bot id = 7420426900)
2025-06-16 16:33:35,814 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-06-16 16:33:35,816 - aiogram.dispatcher - WARNING - Sleep for 5.089880 seconds and try again... (tryings = 12, bot id = 7420426900)
2025-06-16 16:34:03,121 - main - DEBUG - Подключение роутеров
2025-06-16 16:34:03,134 - main - INFO - Запуск приложения
2025-06-16 16:34:03,135 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 16:34:03,137 - main - INFO - Инициализация базы данных
2025-06-16 16:34:03,138 - main - INFO - Начало инициализации базы данных
2025-06-16 16:34:03,139 - main - DEBUG - Создание таблиц
2025-06-16 16:34:03,140 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 16:34:03,142 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 16:34:03,143 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 16:34:03,144 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 16:34:03,145 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:34:03,146 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:34:03,146 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 16:34:03,147 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 16:34:03,148 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 16:34:03,150 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 16:34:03,150 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 16:34:03,151 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:34:03,152 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 16:34:03,153 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 16:34:03,154 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 16:34:03,155 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 16:34:03,156 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 16:34:03,157 - main - DEBUG - Инициализация статусов заказа
2025-06-16 16:34:03,159 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 16:34:03,159 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 16:34:03,160 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 16:34:03,162 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 16:34:03,163 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 16:34:03,164 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 16:34:03,165 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 16:34:03,167 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 16:34:03,168 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 16:34:03,170 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 16:34:03,171 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 16:34:03,173 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 16:34:03,173 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 16:34:03,175 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 16:34:03,176 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 16:34:03,178 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 16:34:03,180 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:34:03,181 - main - DEBUG - Инициализация текстовых полей
2025-06-16 16:34:03,182 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:34:03,183 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 16:34:03,185 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:34:03,186 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 16:34:03,188 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:34:03,189 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 16:34:03,190 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 16:34:03,191 - main - DEBUG - Инициализация тестовых книг
2025-06-16 16:34:03,193 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 16:34:03,194 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 16:34:03,195 - main - INFO - База данных успешно инициализирована
2025-06-16 16:34:03,196 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 16:34:04,884 - main - INFO - Запуск бота
2025-06-16 16:34:04,887 - aiogram.dispatcher - INFO - Start polling
2025-06-16 16:34:05,481 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 16:34:19,187 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:34:19,195 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:34:19,197 - aiogram.event - INFO - Update id=708194564 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 16:34:24,695 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:34:25,056 - aiogram.event - INFO - Update id=708194565 is handled. Duration 360 ms by bot id=7420426900
2025-06-16 16:34:32,735 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:34:32,934 - aiogram.event - INFO - Update id=708194566 is handled. Duration 202 ms by bot id=7420426900
2025-06-16 16:34:36,172 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:34:36,183 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:34:36,185 - aiogram.event - INFO - Update id=708194567 is handled. Duration 15 ms by bot id=7420426900
2025-06-16 16:34:38,535 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:34:38,545 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:34:38,547 - aiogram.event - INFO - Update id=708194568 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 16:34:39,828 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:34:39,836 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:34:39,838 - aiogram.event - INFO - Update id=708194569 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 16:34:41,353 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:34:41,512 - aiogram.event - INFO - Update id=708194570 is handled. Duration 156 ms by bot id=7420426900
2025-06-16 16:34:45,014 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:34:45,016 - admin_state_book_handlers - DEBUG - Вход в обработчик manage_books - Данные: {'user_id': 5069224643}
2025-06-16 16:34:45,173 - aiogram.event - INFO - Update id=708194571 is handled. Duration 156 ms by bot id=7420426900
2025-06-16 16:34:47,394 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:34:47,400 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."author", "t1"."price", "t1"."description", "t1"."photo", "t1"."quantity" FROM "books" AS "t1"', [])
2025-06-16 16:34:47,831 - aiogram.event - INFO - Update id=708194572 is handled. Duration 436 ms by bot id=7420426900
2025-06-16 16:34:58,418 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:34:58,613 - aiogram.event - INFO - Update id=708194573 is handled. Duration 187 ms by bot id=7420426900
2025-06-16 16:35:00,829 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:35:01,013 - aiogram.event - INFO - Update id=708194574 is handled. Duration 188 ms by bot id=7420426900
2025-06-16 16:35:02,774 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:35:02,783 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:35:02,785 - aiogram.event - INFO - Update id=708194575 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:35:04,777 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:35:04,972 - aiogram.event - INFO - Update id=708194576 is handled. Duration 187 ms by bot id=7420426900
2025-06-16 16:35:09,733 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:35:09,871 - aiogram.event - INFO - Update id=708194577 is handled. Duration 139 ms by bot id=7420426900
2025-06-16 16:35:11,823 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:35:11,830 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:35:11,832 - aiogram.event - INFO - Update id=708194578 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:35:12,869 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:35:12,876 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:35:12,877 - aiogram.event - INFO - Update id=708194579 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:35:14,054 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:35:14,062 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:35:14,063 - aiogram.event - INFO - Update id=708194580 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:54:42,478 - aiogram.dispatcher - INFO - Polling stopped
2025-06-16 16:54:42,742 - main - DEBUG - Закрытие соединения с базой данных
2025-06-16 16:54:42,746 - aiogram.dispatcher - INFO - Polling stopped for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 16:54:49,333 - main - DEBUG - Подключение роутеров
2025-06-16 16:54:49,346 - main - INFO - Запуск приложения
2025-06-16 16:54:49,347 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 16:54:49,348 - main - INFO - Инициализация базы данных
2025-06-16 16:54:49,349 - main - INFO - Начало инициализации базы данных
2025-06-16 16:54:49,351 - main - DEBUG - Создание таблиц
2025-06-16 16:54:49,352 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 16:54:49,354 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 16:54:49,354 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 16:54:49,356 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 16:54:49,357 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:54:49,357 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:54:49,358 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 16:54:49,359 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 16:54:49,360 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 16:54:49,362 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 16:54:49,363 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 16:54:49,364 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:54:49,364 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 16:54:49,365 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 16:54:49,366 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 16:54:49,366 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 16:54:49,367 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 16:54:49,368 - main - DEBUG - Инициализация статусов заказа
2025-06-16 16:54:49,369 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 16:54:49,370 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 16:54:49,371 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 16:54:49,372 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 16:54:49,373 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 16:54:49,374 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 16:54:49,375 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 16:54:49,377 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 16:54:49,378 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 16:54:49,379 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 16:54:49,380 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 16:54:49,381 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 16:54:49,381 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 16:54:49,383 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 16:54:49,384 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 16:54:49,384 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 16:54:49,386 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:54:49,386 - main - DEBUG - Инициализация текстовых полей
2025-06-16 16:54:49,388 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:54:49,388 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 16:54:49,390 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:54:49,390 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 16:54:49,391 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:54:49,392 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 16:54:49,393 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 16:54:49,394 - main - DEBUG - Инициализация тестовых книг
2025-06-16 16:54:49,395 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 16:54:49,396 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 16:54:49,397 - main - INFO - База данных успешно инициализирована
2025-06-16 16:54:49,398 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 16:54:49,882 - main - INFO - Запуск бота
2025-06-16 16:54:49,883 - aiogram.dispatcher - INFO - Start polling
2025-06-16 16:54:49,994 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 16:55:01,363 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:55:01,371 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:55:01,373 - aiogram.event - INFO - Update id=708194581 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 16:55:04,363 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:55:04,369 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:55:04,371 - aiogram.event - INFO - Update id=708194582 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 16:55:05,970 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:55:05,977 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:55:05,979 - aiogram.event - INFO - Update id=708194583 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 16:55:07,554 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:55:08,087 - aiogram.event - INFO - Update id=708194584 is handled. Duration 531 ms by bot id=7420426900
2025-06-16 16:57:59,003 - aiogram.dispatcher - INFO - Polling stopped
2025-06-16 16:57:59,262 - main - DEBUG - Закрытие соединения с базой данных
2025-06-16 16:57:59,266 - aiogram.dispatcher - INFO - Polling stopped for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 16:58:39,993 - main - DEBUG - Подключение роутеров
2025-06-16 16:58:40,004 - main - INFO - Запуск приложения
2025-06-16 16:58:40,006 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 16:58:40,007 - main - INFO - Инициализация базы данных
2025-06-16 16:58:40,009 - main - INFO - Начало инициализации базы данных
2025-06-16 16:58:40,009 - main - DEBUG - Создание таблиц
2025-06-16 16:58:40,011 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 16:58:40,012 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 16:58:40,013 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 16:58:40,014 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 16:58:40,016 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:58:40,016 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:58:40,017 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 16:58:40,018 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 16:58:40,019 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 16:58:40,021 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 16:58:40,021 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 16:58:40,022 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 16:58:40,023 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 16:58:40,024 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 16:58:40,024 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 16:58:40,026 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 16:58:40,026 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 16:58:40,027 - main - DEBUG - Инициализация статусов заказа
2025-06-16 16:58:40,028 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 16:58:40,029 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 16:58:40,030 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 16:58:40,031 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 16:58:40,032 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 16:58:40,033 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 16:58:40,033 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 16:58:40,035 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 16:58:40,035 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 16:58:40,036 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 16:58:40,037 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 16:58:40,038 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 16:58:40,039 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 16:58:40,040 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 16:58:40,041 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 16:58:40,042 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 16:58:40,044 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:58:40,045 - main - DEBUG - Инициализация текстовых полей
2025-06-16 16:58:40,046 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:58:40,047 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 16:58:40,048 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:58:40,048 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 16:58:40,050 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 16:58:40,051 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 16:58:40,052 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 16:58:40,053 - main - DEBUG - Инициализация тестовых книг
2025-06-16 16:58:40,054 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 16:58:40,055 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 16:58:40,055 - main - INFO - База данных успешно инициализирована
2025-06-16 16:58:40,056 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 16:58:40,522 - main - INFO - Запуск бота
2025-06-16 16:58:40,525 - aiogram.dispatcher - INFO - Start polling
2025-06-16 16:58:40,633 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 16:58:49,427 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:58:49,950 - aiogram.event - INFO - Update id=708194585 is handled. Duration 514 ms by bot id=7420426900
2025-06-16 16:58:51,953 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:58:51,967 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:58:51,969 - aiogram.event - INFO - Update id=708194586 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 16:58:53,430 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:58:53,438 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:58:53,439 - aiogram.event - INFO - Update id=708194587 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 16:58:54,719 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 16:58:54,727 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 16:58:54,728 - aiogram.event - INFO - Update id=708194588 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 17:03:29,068 - aiogram.dispatcher - INFO - Polling stopped
2025-06-16 17:03:29,327 - main - DEBUG - Закрытие соединения с базой данных
2025-06-16 17:03:29,331 - aiogram.dispatcher - INFO - Polling stopped for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 17:13:53,050 - main - DEBUG - Подключение роутеров
2025-06-16 17:13:53,060 - main - INFO - Запуск приложения
2025-06-16 17:13:53,061 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 17:13:53,062 - main - INFO - Инициализация базы данных
2025-06-16 17:13:53,064 - main - INFO - Начало инициализации базы данных
2025-06-16 17:13:53,064 - main - DEBUG - Создание таблиц
2025-06-16 17:13:53,065 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 17:13:53,068 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 17:13:53,069 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 17:13:53,070 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 17:13:53,071 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:13:53,072 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:13:53,073 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 17:13:53,074 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 17:13:53,075 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 17:13:53,076 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 17:13:53,076 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 17:13:53,077 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:13:53,078 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 17:13:53,079 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 17:13:53,080 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 17:13:53,081 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 17:13:53,082 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 17:13:53,083 - main - DEBUG - Инициализация статусов заказа
2025-06-16 17:13:53,085 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 17:13:53,085 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 17:13:53,086 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 17:13:53,089 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 17:13:53,090 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 17:13:53,092 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 17:13:53,093 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 17:13:53,095 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 17:13:53,096 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 17:13:53,097 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 17:13:53,098 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 17:13:53,099 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 17:13:53,100 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 17:13:53,102 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 17:13:53,103 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 17:13:53,104 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 17:13:53,105 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:13:53,106 - main - DEBUG - Инициализация текстовых полей
2025-06-16 17:13:53,107 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:13:53,108 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 17:13:53,109 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:13:53,110 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 17:13:53,112 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:13:53,112 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 17:13:53,113 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 17:13:53,114 - main - DEBUG - Инициализация тестовых книг
2025-06-16 17:13:53,116 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 17:13:53,117 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 17:13:53,117 - main - INFO - База данных успешно инициализирована
2025-06-16 17:13:53,119 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 17:13:53,575 - main - INFO - Запуск бота
2025-06-16 17:13:53,578 - aiogram.dispatcher - INFO - Start polling
2025-06-16 17:13:53,688 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 17:14:00,729 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:14:01,235 - aiogram.event - INFO - Update id=708194589 is handled. Duration 500 ms by bot id=7420426900
2025-06-16 17:14:03,372 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:14:03,558 - aiogram.event - INFO - Update id=708194590 is handled. Duration 187 ms by bot id=7420426900
2025-06-16 17:14:05,530 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:14:05,538 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:14:05,539 - aiogram.event - INFO - Update id=708194591 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 17:14:06,928 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:14:06,936 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:14:06,938 - aiogram.event - INFO - Update id=708194592 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 17:14:08,200 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:14:08,219 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:14:08,222 - aiogram.event - INFO - Update id=708194593 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 17:16:39,827 - aiogram.dispatcher - INFO - Polling stopped
2025-06-16 17:16:40,089 - main - DEBUG - Закрытие соединения с базой данных
2025-06-16 17:16:40,093 - aiogram.dispatcher - INFO - Polling stopped for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 17:18:57,341 - main - DEBUG - Подключение роутеров
2025-06-16 17:18:57,351 - main - INFO - Запуск приложения
2025-06-16 17:18:57,352 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 17:18:57,353 - main - INFO - Инициализация базы данных
2025-06-16 17:18:57,355 - main - INFO - Начало инициализации базы данных
2025-06-16 17:18:57,355 - main - DEBUG - Создание таблиц
2025-06-16 17:18:57,357 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 17:18:57,358 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 17:18:57,359 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 17:18:57,360 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 17:18:57,361 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:18:57,362 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:18:57,364 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 17:18:57,365 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 17:18:57,366 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 17:18:57,368 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 17:18:57,369 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 17:18:57,369 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:18:57,370 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 17:18:57,371 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 17:18:57,372 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 17:18:57,373 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 17:18:57,373 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 17:18:57,375 - main - DEBUG - Инициализация статусов заказа
2025-06-16 17:18:57,376 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 17:18:57,377 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 17:18:57,378 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 17:18:57,380 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 17:18:57,381 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 17:18:57,382 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 17:18:57,383 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 17:18:57,384 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 17:18:57,385 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 17:18:57,387 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 17:18:57,387 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 17:18:57,389 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 17:18:57,390 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 17:18:57,391 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 17:18:57,392 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 17:18:57,394 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 17:18:57,395 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:18:57,396 - main - DEBUG - Инициализация текстовых полей
2025-06-16 17:18:57,398 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:18:57,399 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 17:18:57,400 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:18:57,401 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 17:18:57,403 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:18:57,404 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 17:18:57,405 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 17:18:57,406 - main - DEBUG - Инициализация тестовых книг
2025-06-16 17:18:57,408 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 17:18:57,409 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 17:18:57,410 - main - INFO - База данных успешно инициализирована
2025-06-16 17:18:57,411 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 17:19:00,884 - main - INFO - Запуск бота
2025-06-16 17:19:00,887 - aiogram.dispatcher - INFO - Start polling
2025-06-16 17:19:02,476 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 17:19:07,326 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:19:09,031 - aiogram.event - INFO - Update id=708194594 is handled. Duration 1703 ms by bot id=7420426900
2025-06-16 17:19:13,954 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:19:14,171 - aiogram.event - INFO - Update id=708194595 is handled. Duration 219 ms by bot id=7420426900
2025-06-16 17:19:16,516 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:19:16,533 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:19:16,534 - aiogram.event - INFO - Update id=708194596 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 17:19:17,809 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:19:17,816 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:19:17,818 - aiogram.event - INFO - Update id=708194597 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 17:19:18,914 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:19:18,921 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:19:18,923 - aiogram.event - INFO - Update id=708194598 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 17:31:47,484 - main - DEBUG - Подключение роутеров
2025-06-16 17:31:47,494 - main - INFO - Запуск приложения
2025-06-16 17:31:47,495 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 17:31:47,497 - main - INFO - Инициализация базы данных
2025-06-16 17:31:47,498 - main - INFO - Начало инициализации базы данных
2025-06-16 17:31:47,499 - main - DEBUG - Создание таблиц
2025-06-16 17:31:47,501 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 17:31:47,503 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 17:31:47,504 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 17:31:47,506 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 17:31:47,507 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:31:47,507 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:31:47,508 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 17:31:47,510 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 17:31:47,512 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 17:31:47,513 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 17:31:47,514 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 17:31:47,514 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:31:47,515 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 17:31:47,516 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 17:31:47,517 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 17:31:47,518 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 17:31:47,518 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 17:31:47,520 - main - DEBUG - Инициализация статусов заказа
2025-06-16 17:31:47,521 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 17:31:47,522 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 17:31:47,523 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 17:31:47,524 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 17:31:47,525 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 17:31:47,526 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 17:31:47,527 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 17:31:47,529 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 17:31:47,530 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 17:31:47,532 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 17:31:47,533 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 17:31:47,535 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 17:31:47,536 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 17:31:47,538 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 17:31:47,539 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 17:31:47,540 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 17:31:47,542 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:31:47,543 - main - DEBUG - Инициализация текстовых полей
2025-06-16 17:31:47,544 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:31:47,545 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 17:31:47,546 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:31:47,547 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 17:31:47,548 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:31:47,549 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 17:31:47,550 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 17:31:47,551 - main - DEBUG - Инициализация тестовых книг
2025-06-16 17:31:47,552 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 17:31:47,553 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 17:31:47,554 - main - INFO - База данных успешно инициализирована
2025-06-16 17:31:47,556 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 17:31:48,009 - main - INFO - Запуск бота
2025-06-16 17:31:48,012 - aiogram.dispatcher - INFO - Start polling
2025-06-16 17:31:48,149 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 17:39:46,484 - main - DEBUG - Подключение роутеров
2025-06-16 17:39:46,497 - main - INFO - Запуск приложения
2025-06-16 17:39:46,498 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 17:39:46,499 - main - INFO - Инициализация базы данных
2025-06-16 17:39:46,501 - main - INFO - Начало инициализации базы данных
2025-06-16 17:39:46,501 - main - DEBUG - Создание таблиц
2025-06-16 17:39:46,503 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 17:39:46,505 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 17:39:46,506 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 17:39:46,508 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 17:39:46,509 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:39:46,510 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:39:46,511 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 17:39:46,512 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 17:39:46,514 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 17:39:46,515 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 17:39:46,516 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 17:39:46,517 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:39:46,518 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 17:39:46,519 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 17:39:46,520 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 17:39:46,521 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 17:39:46,521 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 17:39:46,522 - main - DEBUG - Инициализация статусов заказа
2025-06-16 17:39:46,523 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 17:39:46,524 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 17:39:46,525 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 17:39:46,526 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 17:39:46,527 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 17:39:46,529 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 17:39:46,530 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 17:39:46,531 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 17:39:46,532 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 17:39:46,534 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 17:39:46,535 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 17:39:46,537 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 17:39:46,537 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 17:39:46,539 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 17:39:46,540 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 17:39:46,541 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 17:39:46,542 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:39:46,543 - main - DEBUG - Инициализация текстовых полей
2025-06-16 17:39:46,545 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:39:46,546 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 17:39:46,547 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:39:46,548 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 17:39:46,550 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:39:46,551 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 17:39:46,552 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 17:39:46,553 - main - DEBUG - Инициализация тестовых книг
2025-06-16 17:39:46,555 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 17:39:46,556 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 17:39:46,556 - main - INFO - База данных успешно инициализирована
2025-06-16 17:39:46,557 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 17:39:47,102 - main - INFO - Запуск бота
2025-06-16 17:39:47,104 - aiogram.dispatcher - INFO - Start polling
2025-06-16 17:39:47,213 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 17:39:52,692 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:39:52,704 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:39:52,707 - aiogram.event - INFO - Update id=708194599 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 17:39:54,772 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:39:54,780 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:39:54,781 - aiogram.event - INFO - Update id=708194600 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 17:39:56,458 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:39:56,466 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:39:56,468 - aiogram.event - INFO - Update id=708194601 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 17:39:59,015 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:39:59,536 - aiogram.event - INFO - Update id=708194602 is handled. Duration 531 ms by bot id=7420426900
2025-06-16 17:40:01,055 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:40:01,229 - aiogram.event - INFO - Update id=708194603 is handled. Duration 172 ms by bot id=7420426900
2025-06-16 17:40:03,934 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:40:03,954 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:40:03,957 - aiogram.event - INFO - Update id=708194604 is handled. Duration 31 ms by bot id=7420426900
2025-06-16 17:43:42,498 - main - DEBUG - Подключение роутеров
2025-06-16 17:43:42,508 - main - INFO - Запуск приложения
2025-06-16 17:43:42,509 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 17:43:42,511 - main - INFO - Инициализация базы данных
2025-06-16 17:43:42,513 - main - INFO - Начало инициализации базы данных
2025-06-16 17:43:42,514 - main - DEBUG - Создание таблиц
2025-06-16 17:43:42,515 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 17:43:42,517 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 17:43:42,518 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 17:43:42,520 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 17:43:42,521 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:43:42,522 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:43:42,523 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 17:43:42,524 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 17:43:42,525 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 17:43:42,527 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 17:43:42,528 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 17:43:42,529 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:43:42,529 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 17:43:42,530 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 17:43:42,531 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 17:43:42,532 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 17:43:42,532 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 17:43:42,534 - main - DEBUG - Инициализация статусов заказа
2025-06-16 17:43:42,535 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 17:43:42,536 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 17:43:42,537 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 17:43:42,539 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 17:43:42,540 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 17:43:42,543 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 17:43:42,544 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 17:43:42,546 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 17:43:42,547 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 17:43:42,549 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 17:43:42,550 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 17:43:42,552 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 17:43:42,553 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 17:43:42,555 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 17:43:42,556 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 17:43:42,557 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 17:43:42,558 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:43:42,560 - main - DEBUG - Инициализация текстовых полей
2025-06-16 17:43:42,562 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:43:42,562 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 17:43:42,564 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:43:42,565 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 17:43:42,566 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:43:42,566 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 17:43:42,567 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 17:43:42,568 - main - DEBUG - Инициализация тестовых книг
2025-06-16 17:43:42,569 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 17:43:42,570 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 17:43:42,571 - main - INFO - База данных успешно инициализирована
2025-06-16 17:43:42,572 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 17:43:43,101 - main - INFO - Запуск бота
2025-06-16 17:43:43,104 - aiogram.dispatcher - INFO - Start polling
2025-06-16 17:43:43,210 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 17:43:47,912 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:43:47,913 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:43:47,923 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:43:47,925 - aiogram.event - INFO - Update id=708194605 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 17:43:50,344 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:43:50,345 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:43:50,353 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:43:50,354 - aiogram.event - INFO - Update id=708194606 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 17:43:52,657 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:43:52,658 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:43:53,225 - aiogram.event - INFO - Update id=708194607 is handled. Duration 578 ms by bot id=7420426900
2025-06-16 17:43:56,499 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:43:56,500 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:43:56,648 - aiogram.event - INFO - Update id=708194608 is handled. Duration 156 ms by bot id=7420426900
2025-06-16 17:43:59,092 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:43:59,095 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:43:59,103 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:43:59,105 - aiogram.event - INFO - Update id=708194609 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 17:44:00,048 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:44:00,049 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:44:00,060 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:44:00,062 - aiogram.event - INFO - Update id=708194610 is handled. Duration 15 ms by bot id=7420426900
2025-06-16 17:44:01,811 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:44:01,813 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:44:01,830 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:44:01,832 - aiogram.event - INFO - Update id=708194611 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 17:47:35,563 - main - DEBUG - Подключение роутеров
2025-06-16 17:47:35,573 - main - INFO - Запуск приложения
2025-06-16 17:47:35,574 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 17:47:35,575 - main - INFO - Инициализация базы данных
2025-06-16 17:47:35,577 - main - INFO - Начало инициализации базы данных
2025-06-16 17:47:35,578 - main - DEBUG - Создание таблиц
2025-06-16 17:47:35,579 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 17:47:35,581 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 17:47:35,582 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 17:47:35,583 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 17:47:35,584 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:47:35,585 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:47:35,585 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 17:47:35,586 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 17:47:35,587 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 17:47:35,589 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 17:47:35,590 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 17:47:35,591 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:47:35,591 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 17:47:35,592 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 17:47:35,593 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 17:47:35,594 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 17:47:35,594 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 17:47:35,596 - main - DEBUG - Инициализация статусов заказа
2025-06-16 17:47:35,597 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 17:47:35,598 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 17:47:35,599 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 17:47:35,600 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 17:47:35,601 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 17:47:35,602 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 17:47:35,603 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 17:47:35,605 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 17:47:35,606 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 17:47:35,608 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 17:47:35,609 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 17:47:35,611 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 17:47:35,612 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 17:47:35,613 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 17:47:35,614 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 17:47:35,615 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 17:47:35,617 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:47:35,618 - main - DEBUG - Инициализация текстовых полей
2025-06-16 17:47:35,620 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:47:35,621 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 17:47:35,623 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:47:35,624 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 17:47:35,625 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:47:35,626 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 17:47:35,628 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 17:47:35,629 - main - DEBUG - Инициализация тестовых книг
2025-06-16 17:47:35,633 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 17:47:35,635 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 17:47:35,647 - main - INFO - База данных успешно инициализирована
2025-06-16 17:47:35,665 - main - ERROR - Ошибка при запуске бота - Ошибка: name 'BotCommand' is not defined
2025-06-16 17:47:35,671 - main - ERROR - Traceback:
Traceback (most recent call last):
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\main.py", line 243, in main
    BotCommand(command="start", description="Запустить бота"),
    ^^^^^^^^^^
NameError: name 'BotCommand' is not defined

2025-06-16 17:47:35,677 - main - DEBUG - Закрытие соединения с базой данных
2025-06-16 17:47:35,678 - main - ERROR - Критическая ошибка при запуске приложения - Ошибка: name 'BotCommand' is not defined
2025-06-16 17:47:35,711 - main - ERROR - Traceback:
Traceback (most recent call last):
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\main.py", line 263, in <module>
    asyncio.run(main())
  File "C:\Users\Dmitriy\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "C:\Users\Dmitriy\AppData\Local\Programs\Python\Python311\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Dmitriy\AppData\Local\Programs\Python\Python311\Lib\asyncio\base_events.py", line 650, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "C:\Cursor\Knigi_Istochnik_Schizni_bot\main.py", line 243, in main
    BotCommand(command="start", description="Запустить бота"),
    ^^^^^^^^^^
NameError: name 'BotCommand' is not defined

2025-06-16 17:54:26,562 - main - DEBUG - Подключение роутеров
2025-06-16 17:54:26,572 - main - INFO - Запуск приложения
2025-06-16 17:54:26,573 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 17:54:26,574 - main - INFO - Инициализация базы данных
2025-06-16 17:54:26,575 - main - INFO - Начало инициализации базы данных
2025-06-16 17:54:26,576 - main - DEBUG - Создание таблиц
2025-06-16 17:54:26,578 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 17:54:26,579 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 17:54:26,580 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 17:54:26,582 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 17:54:26,583 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:54:26,583 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:54:26,584 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 17:54:26,585 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 17:54:26,585 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 17:54:26,587 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 17:54:26,588 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 17:54:26,589 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:54:26,590 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 17:54:26,591 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 17:54:26,592 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 17:54:26,593 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 17:54:26,593 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 17:54:26,595 - main - DEBUG - Инициализация статусов заказа
2025-06-16 17:54:26,595 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 17:54:26,596 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 17:54:26,597 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 17:54:26,599 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 17:54:26,600 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 17:54:26,601 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 17:54:26,602 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 17:54:26,604 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 17:54:26,604 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 17:54:26,606 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 17:54:26,607 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 17:54:26,608 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 17:54:26,608 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 17:54:26,610 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 17:54:26,611 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 17:54:26,612 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 17:54:26,614 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:54:26,615 - main - DEBUG - Инициализация текстовых полей
2025-06-16 17:54:26,617 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:54:26,618 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 17:54:26,620 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:54:26,621 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 17:54:26,622 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:54:26,623 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 17:54:26,625 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 17:54:26,626 - main - DEBUG - Инициализация тестовых книг
2025-06-16 17:54:26,627 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 17:54:26,628 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 17:54:26,629 - main - INFO - База данных успешно инициализирована
2025-06-16 17:54:26,631 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 17:54:27,166 - main - INFO - Запуск бота
2025-06-16 17:54:27,169 - aiogram.dispatcher - INFO - Start polling
2025-06-16 17:54:27,418 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 17:54:27,606 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:54:27,607 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:54:27,609 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:54:27,610 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:54:27,612 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:54:27,612 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:54:27,615 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:54:27,616 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:54:27,618 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:54:27,618 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:54:27,635 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:54:27,636 - aiogram.event - INFO - Update id=708194612 is handled. Duration 31 ms by bot id=7420426900
2025-06-16 17:54:27,637 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:54:27,638 - aiogram.event - INFO - Update id=708194613 is handled. Duration 31 ms by bot id=7420426900
2025-06-16 17:54:27,639 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:54:27,640 - aiogram.event - INFO - Update id=708194614 is handled. Duration 31 ms by bot id=7420426900
2025-06-16 17:54:28,201 - aiogram.event - INFO - Update id=708194615 is handled. Duration 577 ms by bot id=7420426900
2025-06-16 17:54:28,202 - aiogram.event - INFO - Update id=708194616 is handled. Duration 577 ms by bot id=7420426900
2025-06-16 17:54:37,242 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:54:37,243 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:54:37,363 - aiogram.event - INFO - Update id=708194617 is handled. Duration 110 ms by bot id=7420426900
2025-06-16 17:54:39,677 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:54:39,678 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:54:39,686 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:54:39,688 - aiogram.event - INFO - Update id=708194618 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 17:54:46,879 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:54:46,880 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:54:47,102 - aiogram.event - INFO - Update id=708194619 is handled. Duration 235 ms by bot id=7420426900
2025-06-16 17:54:49,274 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:54:49,275 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:54:49,622 - aiogram.event - INFO - Update id=708194620 is handled. Duration 343 ms by bot id=7420426900
2025-06-16 17:54:51,663 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:54:51,664 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:54:51,672 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:54:51,674 - aiogram.event - INFO - Update id=708194621 is handled. Duration 0 ms by bot id=7420426900
2025-06-16 17:54:52,931 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:54:52,932 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:54:52,940 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:54:52,942 - aiogram.event - INFO - Update id=708194622 is handled. Duration 14 ms by bot id=7420426900
2025-06-16 17:54:54,466 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:54:54,468 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 17:54:54,480 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."admin_id", "t1"."question", "t1"."answer", "t1"."created_at", "t1"."updated_at", "t1"."is_closed" FROM "dialog" AS "t1" WHERE (("t1"."user_id" = ?) AND ("t1"."is_closed" = ?)) LIMIT ? OFFSET ?', [5069224643, False, 1, 0])
2025-06-16 17:54:54,482 - aiogram.event - INFO - Update id=708194623 is handled. Duration 16 ms by bot id=7420426900
2025-06-16 17:59:51,302 - main - DEBUG - Подключение роутеров
2025-06-16 17:59:51,312 - main - INFO - Запуск приложения
2025-06-16 17:59:51,313 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-16 17:59:51,315 - main - INFO - Инициализация базы данных
2025-06-16 17:59:51,316 - main - INFO - Начало инициализации базы данных
2025-06-16 17:59:51,317 - main - DEBUG - Создание таблиц
2025-06-16 17:59:51,319 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "admin" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "user_name" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "role" VARCHAR(255) NOT NULL, "display_name" VARCHAR(255))', [])
2025-06-16 17:59:51,320 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "admin_user_id" ON "admin" ("user_id")', [])
2025-06-16 17:59:51,321 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "books" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "author" VARCHAR(255) NOT NULL, "price" REAL NOT NULL, "description" TEXT NOT NULL, "photo" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL)', [])
2025-06-16 17:59:51,323 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "dialog" ("id" INTEGER NOT NULL PRIMARY KEY, "user_id" INTEGER NOT NULL, "admin_id" INTEGER NOT NULL, "question" TEXT NOT NULL, "answer" TEXT, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, "is_closed" INTEGER NOT NULL)', [])
2025-06-16 17:59:51,324 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "gallerytext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:59:51,325 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "greeting" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:59:51,325 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderstatus" ("id" INTEGER NOT NULL PRIMARY KEY, "name" VARCHAR(255) NOT NULL, "description" TEXT NOT NULL, "client_message" TEXT NOT NULL, "emoji" VARCHAR(255) NOT NULL)', [])
2025-06-16 17:59:51,326 - peewee - DEBUG - ('CREATE UNIQUE INDEX IF NOT EXISTS "orderstatus_name" ON "orderstatus" ("name")', [])
2025-06-16 17:59:51,328 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "order" ("id" INTEGER NOT NULL PRIMARY KEY, "telegram_id" INTEGER NOT NULL, "fio" VARCHAR(255) NOT NULL, "addres" VARCHAR(255) NOT NULL, "phone" VARCHAR(255) NOT NULL, "book_id" INTEGER NOT NULL, "book_info" TEXT NOT NULL, "status_id" INTEGER NOT NULL, "created_at" DATETIME NOT NULL, "updated_at" DATETIME NOT NULL, FOREIGN KEY ("book_id") REFERENCES "books" ("id"), FOREIGN KEY ("status_id") REFERENCES "orderstatus" ("id"))', [])
2025-06-16 17:59:51,330 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_book_id" ON "order" ("book_id")', [])
2025-06-16 17:59:51,331 - peewee - DEBUG - ('CREATE INDEX IF NOT EXISTS "order_status_id" ON "order" ("status_id")', [])
2025-06-16 17:59:51,332 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS "orderpretext" ("id" INTEGER NOT NULL PRIMARY KEY, "text" TEXT NOT NULL)', [])
2025-06-16 17:59:51,332 - main - DEBUG - Создание таблицы order_statuses
2025-06-16 17:59:51,333 - peewee - DEBUG - ('CREATE TABLE IF NOT EXISTS order_statuses (id INTEGER PRIMARY KEY, name VARCHAR(255) UNIQUE, description TEXT, client_message TEXT, emoji VARCHAR(255));', None)
2025-06-16 17:59:51,334 - main - DEBUG - Проверка и добавление колонок в таблицу admin
2025-06-16 17:59:51,335 - peewee - DEBUG - ('PRAGMA table_info(admin);', None)
2025-06-16 17:59:51,335 - main - DEBUG - Существующие колонки в таблице admin: ['id', 'user_id', 'user_name', 'phone', 'role', 'display_name']
2025-06-16 17:59:51,337 - main - DEBUG - Инициализация статусов заказа
2025-06-16 17:59:51,338 - data.models - DEBUG - Получение списка статусов заказа по умолчанию
2025-06-16 17:59:51,339 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['new', 1, 0])
2025-06-16 17:59:51,339 - main - DEBUG - Статус заказа создан/обновлен: new
2025-06-16 17:59:51,341 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['processing', 1, 0])
2025-06-16 17:59:51,342 - main - DEBUG - Статус заказа создан/обновлен: processing
2025-06-16 17:59:51,344 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['supplier_notified', 1, 0])
2025-06-16 17:59:51,346 - main - DEBUG - Статус заказа создан/обновлен: supplier_notified
2025-06-16 17:59:51,347 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['book_taken', 1, 0])
2025-06-16 17:59:51,348 - main - DEBUG - Статус заказа создан/обновлен: book_taken
2025-06-16 17:59:51,350 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['in_transit', 1, 0])
2025-06-16 17:59:51,351 - main - DEBUG - Статус заказа создан/обновлен: in_transit
2025-06-16 17:59:51,353 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['delivered', 1, 0])
2025-06-16 17:59:51,353 - main - DEBUG - Статус заказа создан/обновлен: delivered
2025-06-16 17:59:51,355 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."name", "t1"."description", "t1"."client_message", "t1"."emoji" FROM "orderstatus" AS "t1" WHERE ("t1"."name" = ?) LIMIT ? OFFSET ?', ['cancelled', 1, 0])
2025-06-16 17:59:51,355 - main - DEBUG - Статус заказа создан/обновлен: cancelled
2025-06-16 17:59:51,356 - main - DEBUG - Создание администратора по умолчанию
2025-06-16 17:59:51,358 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 17:59:51,359 - main - DEBUG - Инициализация текстовых полей
2025-06-16 17:59:51,360 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:59:51,361 - main - DEBUG - Приветствие создано/обновлено
2025-06-16 17:59:51,363 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:59:51,363 - main - DEBUG - Текст галереи создан/обновлен
2025-06-16 17:59:51,365 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" WHERE ("t1"."id" = ?) LIMIT ? OFFSET ?', [1, 1, 0])
2025-06-16 17:59:51,366 - main - DEBUG - Текст оформления заказа создан/обновлен
2025-06-16 17:59:51,367 - main - INFO - Текстовые поля успешно инициализированы
2025-06-16 17:59:51,368 - main - DEBUG - Инициализация тестовых книг
2025-06-16 17:59:51,370 - peewee - DEBUG - ('SELECT COUNT(1) FROM (SELECT 1 FROM "books" AS "t1") AS "_wrapped"', [])
2025-06-16 17:59:51,371 - main - DEBUG - Текущее количество книг в базе: 1
2025-06-16 17:59:51,371 - main - INFO - База данных успешно инициализирована
2025-06-16 17:59:51,373 - main - DEBUG - Установка команд бота - Данные: {'commands': [BotCommand(command='start', description='Запустить бота'), BotCommand(command='help', description='Получить помощь')]}
2025-06-16 17:59:51,836 - main - INFO - Запуск бота
2025-06-16 17:59:51,838 - aiogram.dispatcher - INFO - Start polling
2025-06-16 17:59:51,955 - aiogram.dispatcher - INFO - Run polling for bot @L_E_Istochnik_Schizni_bot id=7420426900 - 'L_E_Istochnik_Schizni'
2025-06-16 18:00:04,084 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:04,087 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:04,088 - admin_edit_great - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 18:00:04,090 - admin_edit_great - DEBUG - Вход в show_greeting_text_for_edit - Данные: {'user_id': 5069224643}
2025-06-16 18:00:04,091 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "greeting" AS "t1" LIMIT ? OFFSET ?', [1, 0])
2025-06-16 18:00:04,678 - aiogram.event - INFO - Update id=708194624 is handled. Duration 593 ms by bot id=7420426900
2025-06-16 18:00:07,880 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:07,886 - admin_edit_texts_handlers - DEBUG - Вход в show_order_pretext_for_edit - Данные: {'user_id': 5069224643}
2025-06-16 18:00:07,946 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "orderpretext" AS "t1" LIMIT ? OFFSET ?', [1, 0])
2025-06-16 18:00:07,947 - admin_edit_texts_handlers - DEBUG - Отправка сообщения с текущим текстом заказа и кнопкой редактирования
2025-06-16 18:00:08,166 - aiogram.event - INFO - Update id=708194625 is handled. Duration 297 ms by bot id=7420426900
2025-06-16 18:00:10,357 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:10,359 - admin_edit_texts_handlers - DEBUG - Вход в show_gallery_text_for_edit - Данные: {'user_id': 5069224643}
2025-06-16 18:00:10,379 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."text" FROM "gallerytext" AS "t1" LIMIT ? OFFSET ?', [1, 0])
2025-06-16 18:00:10,380 - admin_edit_texts_handlers - DEBUG - Отправка сообщения с текущим текстом галереи и кнопкой редактирования
2025-06-16 18:00:10,560 - aiogram.event - INFO - Update id=708194626 is handled. Duration 202 ms by bot id=7420426900
2025-06-16 18:00:14,661 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:14,664 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:14,665 - admin_edit_great - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 18:00:14,668 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:14,669 - admin_rigister_admin - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 18:00:14,672 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:14,673 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 18:00:14,992 - aiogram.event - INFO - Update id=708194627 is handled. Duration 343 ms by bot id=7420426900
2025-06-16 18:00:18,433 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:18,436 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:18,437 - admin_edit_great - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 18:00:18,440 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:18,441 - admin_rigister_admin - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 18:00:18,445 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:18,446 - admin_state_book_handlers - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 18:00:18,711 - aiogram.event - INFO - Update id=708194628 is handled. Duration 281 ms by bot id=7420426900
2025-06-16 18:00:20,963 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:20,966 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:20,968 - admin_edit_great - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 18:00:20,970 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1" WHERE ("t1"."user_id" = ?) LIMIT ? OFFSET ?', [5069224643, 1, 0])
2025-06-16 18:00:20,971 - admin_rigister_admin - DEBUG - is_admin_filter: Проверка пользователя 5069224643. Результат: True - Данные: {'user_id': 5069224643, 'is_admin': True}
2025-06-16 18:00:20,974 - admin_rigister_admin - DEBUG - Вход в show_list_admins - Данные: {'user_id': 5069224643}
2025-06-16 18:00:20,975 - admin_rigister_admin - DEBUG - Начало функции list_admins
2025-06-16 18:00:20,976 - peewee - DEBUG - ('SELECT "t1"."id", "t1"."user_id", "t1"."user_name", "t1"."phone", "t1"."role", "t1"."display_name" FROM "admin" AS "t1"', [])
2025-06-16 18:00:20,977 - admin_rigister_admin - INFO - Найдено 1 администраторов. Отправка списка.
2025-06-16 18:00:21,189 - admin_rigister_admin - DEBUG - Отправка информации об администраторе: 5069224643 - Данные: {'admin_id': 5069224643, 'user_name': 'Dmitriy_hrist_muz'}
2025-06-16 18:00:21,399 - admin_rigister_admin - DEBUG - Список администраторов отправлен. Завершение list_admins
2025-06-16 18:00:21,534 - admin_rigister_admin - DEBUG - Выход из show_list_admins - Данные: {'user_id': 5069224643}
2025-06-16 18:00:21,538 - aiogram.event - INFO - Update id=708194629 is handled. Duration 578 ms by bot id=7420426900
2025-06-16 23:04:23,000 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-06-16 23:04:23,001 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 7420426900)
2025-06-16 23:04:45,138 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:04:45,140 - aiogram.dispatcher - WARNING - Sleep for 1.231043 seconds and try again... (tryings = 1, bot id = 7420426900)
2025-06-16 23:05:07,423 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:05:07,424 - aiogram.dispatcher - WARNING - Sleep for 1.605777 seconds and try again... (tryings = 2, bot id = 7420426900)
2025-06-16 23:05:30,085 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:05:30,087 - aiogram.dispatcher - WARNING - Sleep for 1.958281 seconds and try again... (tryings = 3, bot id = 7420426900)
2025-06-16 23:05:53,097 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:05:53,098 - aiogram.dispatcher - WARNING - Sleep for 2.604554 seconds and try again... (tryings = 4, bot id = 7420426900)
2025-06-16 23:06:16,763 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:06:16,764 - aiogram.dispatcher - WARNING - Sleep for 3.513396 seconds and try again... (tryings = 5, bot id = 7420426900)
2025-06-16 23:06:41,313 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:06:41,314 - aiogram.dispatcher - WARNING - Sleep for 4.504669 seconds and try again... (tryings = 6, bot id = 7420426900)
2025-06-16 23:07:06,862 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:07:06,864 - aiogram.dispatcher - WARNING - Sleep for 4.969259 seconds and try again... (tryings = 7, bot id = 7420426900)
2025-06-16 23:07:32,882 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:07:32,884 - aiogram.dispatcher - WARNING - Sleep for 4.967618 seconds and try again... (tryings = 8, bot id = 7420426900)
2025-06-16 23:07:58,920 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:07:58,922 - aiogram.dispatcher - WARNING - Sleep for 5.017039 seconds and try again... (tryings = 9, bot id = 7420426900)
2025-06-16 23:08:25,003 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:08:25,004 - aiogram.dispatcher - WARNING - Sleep for 5.120775 seconds and try again... (tryings = 10, bot id = 7420426900)
2025-06-16 23:08:51,160 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:08:51,161 - aiogram.dispatcher - WARNING - Sleep for 4.960743 seconds and try again... (tryings = 11, bot id = 7420426900)
2025-06-16 23:09:17,227 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:09:17,228 - aiogram.dispatcher - WARNING - Sleep for 4.910312 seconds and try again... (tryings = 12, bot id = 7420426900)
2025-06-16 23:09:43,184 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:09:43,185 - aiogram.dispatcher - WARNING - Sleep for 5.028226 seconds and try again... (tryings = 13, bot id = 7420426900)
2025-06-16 23:10:09,270 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:10:09,272 - aiogram.dispatcher - WARNING - Sleep for 5.095491 seconds and try again... (tryings = 14, bot id = 7420426900)
2025-06-16 23:10:35,473 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:10:35,474 - aiogram.dispatcher - WARNING - Sleep for 4.722973 seconds and try again... (tryings = 15, bot id = 7420426900)
2025-06-16 23:11:01,250 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:11:01,252 - aiogram.dispatcher - WARNING - Sleep for 5.042038 seconds and try again... (tryings = 16, bot id = 7420426900)
2025-06-16 23:11:27,343 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:11:27,344 - aiogram.dispatcher - WARNING - Sleep for 5.097527 seconds and try again... (tryings = 17, bot id = 7420426900)
2025-06-16 23:11:53,477 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:11:53,479 - aiogram.dispatcher - WARNING - Sleep for 4.976630 seconds and try again... (tryings = 18, bot id = 7420426900)
2025-06-16 23:12:19,511 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:12:19,512 - aiogram.dispatcher - WARNING - Sleep for 5.082131 seconds and try again... (tryings = 19, bot id = 7420426900)
2025-06-16 23:12:45,638 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:12:45,640 - aiogram.dispatcher - WARNING - Sleep for 4.810274 seconds and try again... (tryings = 20, bot id = 7420426900)
2025-06-16 23:13:11,494 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:13:11,496 - aiogram.dispatcher - WARNING - Sleep for 4.959834 seconds and try again... (tryings = 21, bot id = 7420426900)
2025-06-16 23:13:37,505 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:13:37,507 - aiogram.dispatcher - WARNING - Sleep for 5.031279 seconds and try again... (tryings = 22, bot id = 7420426900)
2025-06-16 23:14:03,800 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:14:03,801 - aiogram.dispatcher - WARNING - Sleep for 4.949697 seconds and try again... (tryings = 23, bot id = 7420426900)
2025-06-16 23:14:29,810 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:14:29,811 - aiogram.dispatcher - WARNING - Sleep for 4.922034 seconds and try again... (tryings = 24, bot id = 7420426900)
2025-06-16 23:14:55,802 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:14:55,803 - aiogram.dispatcher - WARNING - Sleep for 5.024383 seconds and try again... (tryings = 25, bot id = 7420426900)
2025-06-16 23:15:21,869 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:15:21,871 - aiogram.dispatcher - WARNING - Sleep for 4.962108 seconds and try again... (tryings = 26, bot id = 7420426900)
2025-06-16 23:15:47,888 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:15:47,890 - aiogram.dispatcher - WARNING - Sleep for 4.857379 seconds and try again... (tryings = 27, bot id = 7420426900)
2025-06-16 23:16:13,819 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:16:13,820 - aiogram.dispatcher - WARNING - Sleep for 5.046116 seconds and try again... (tryings = 28, bot id = 7420426900)
2025-06-16 23:16:39,902 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:16:39,903 - aiogram.dispatcher - WARNING - Sleep for 4.990070 seconds and try again... (tryings = 29, bot id = 7420426900)
2025-06-16 23:17:05,945 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:17:05,947 - aiogram.dispatcher - WARNING - Sleep for 4.987374 seconds and try again... (tryings = 30, bot id = 7420426900)
2025-06-16 23:17:31,982 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:17:31,983 - aiogram.dispatcher - WARNING - Sleep for 5.139755 seconds and try again... (tryings = 31, bot id = 7420426900)
2025-06-16 23:17:58,174 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:17:58,176 - aiogram.dispatcher - WARNING - Sleep for 5.036297 seconds and try again... (tryings = 32, bot id = 7420426900)
2025-06-16 23:18:24,264 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:18:24,266 - aiogram.dispatcher - WARNING - Sleep for 5.123469 seconds and try again... (tryings = 33, bot id = 7420426900)
2025-06-16 23:18:50,466 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:18:50,467 - aiogram.dispatcher - WARNING - Sleep for 4.924179 seconds and try again... (tryings = 34, bot id = 7420426900)
2025-06-16 23:19:16,574 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:19:16,575 - aiogram.dispatcher - WARNING - Sleep for 5.062407 seconds and try again... (tryings = 35, bot id = 7420426900)
2025-06-16 23:19:42,684 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:19:42,685 - aiogram.dispatcher - WARNING - Sleep for 5.025366 seconds and try again... (tryings = 36, bot id = 7420426900)
2025-06-16 23:20:08,761 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:20:08,762 - aiogram.dispatcher - WARNING - Sleep for 5.007951 seconds and try again... (tryings = 37, bot id = 7420426900)
2025-06-16 23:20:34,823 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:20:34,825 - aiogram.dispatcher - WARNING - Sleep for 4.973541 seconds and try again... (tryings = 38, bot id = 7420426900)
2025-06-16 23:21:00,846 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:21:00,847 - aiogram.dispatcher - WARNING - Sleep for 4.904952 seconds and try again... (tryings = 39, bot id = 7420426900)
2025-06-16 23:21:26,814 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:21:26,815 - aiogram.dispatcher - WARNING - Sleep for 5.057878 seconds and try again... (tryings = 40, bot id = 7420426900)
2025-06-16 23:21:52,938 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:21:52,940 - aiogram.dispatcher - WARNING - Sleep for 5.135458 seconds and try again... (tryings = 41, bot id = 7420426900)
2025-06-16 23:22:19,134 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:22:19,135 - aiogram.dispatcher - WARNING - Sleep for 4.971631 seconds and try again... (tryings = 42, bot id = 7420426900)
2025-06-16 23:22:45,153 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:22:45,155 - aiogram.dispatcher - WARNING - Sleep for 4.943168 seconds and try again... (tryings = 43, bot id = 7420426900)
2025-06-16 23:23:11,156 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:23:11,157 - aiogram.dispatcher - WARNING - Sleep for 5.121292 seconds and try again... (tryings = 44, bot id = 7420426900)
2025-06-16 23:23:37,331 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:23:37,332 - aiogram.dispatcher - WARNING - Sleep for 4.896185 seconds and try again... (tryings = 45, bot id = 7420426900)
2025-06-16 23:24:03,437 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:24:03,438 - aiogram.dispatcher - WARNING - Sleep for 4.872389 seconds and try again... (tryings = 46, bot id = 7420426900)
2025-06-16 23:24:29,324 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:24:29,326 - aiogram.dispatcher - WARNING - Sleep for 4.950361 seconds and try again... (tryings = 47, bot id = 7420426900)
2025-06-16 23:24:55,326 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:24:55,328 - aiogram.dispatcher - WARNING - Sleep for 4.943717 seconds and try again... (tryings = 48, bot id = 7420426900)
2025-06-16 23:25:21,325 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:25:21,326 - aiogram.dispatcher - WARNING - Sleep for 4.985304 seconds and try again... (tryings = 49, bot id = 7420426900)
2025-06-16 23:25:47,359 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:25:47,360 - aiogram.dispatcher - WARNING - Sleep for 5.018509 seconds and try again... (tryings = 50, bot id = 7420426900)
2025-06-16 23:26:13,443 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:26:13,444 - aiogram.dispatcher - WARNING - Sleep for 5.100260 seconds and try again... (tryings = 51, bot id = 7420426900)
2025-06-16 23:26:39,574 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:26:39,575 - aiogram.dispatcher - WARNING - Sleep for 5.018849 seconds and try again... (tryings = 52, bot id = 7420426900)
2025-06-16 23:27:05,639 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:27:05,641 - aiogram.dispatcher - WARNING - Sleep for 5.152543 seconds and try again... (tryings = 53, bot id = 7420426900)
2025-06-16 23:27:31,846 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:27:31,847 - aiogram.dispatcher - WARNING - Sleep for 5.004137 seconds and try again... (tryings = 54, bot id = 7420426900)
2025-06-16 23:27:57,906 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:27:57,908 - aiogram.dispatcher - WARNING - Sleep for 4.915040 seconds and try again... (tryings = 55, bot id = 7420426900)
2025-06-16 23:28:23,889 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:28:23,890 - aiogram.dispatcher - WARNING - Sleep for 5.107225 seconds and try again... (tryings = 56, bot id = 7420426900)
2025-06-16 23:28:50,060 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:28:50,062 - aiogram.dispatcher - WARNING - Sleep for 5.143104 seconds and try again... (tryings = 57, bot id = 7420426900)
2025-06-16 23:29:16,311 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:29:16,312 - aiogram.dispatcher - WARNING - Sleep for 5.033267 seconds and try again... (tryings = 58, bot id = 7420426900)
2025-06-16 23:29:42,394 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:29:42,395 - aiogram.dispatcher - WARNING - Sleep for 4.853118 seconds and try again... (tryings = 59, bot id = 7420426900)
2025-06-16 23:30:08,281 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:30:08,282 - aiogram.dispatcher - WARNING - Sleep for 5.073025 seconds and try again... (tryings = 60, bot id = 7420426900)
2025-06-16 23:30:34,512 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:30:34,513 - aiogram.dispatcher - WARNING - Sleep for 4.992073 seconds and try again... (tryings = 61, bot id = 7420426900)
2025-06-16 23:31:00,684 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:31:00,686 - aiogram.dispatcher - WARNING - Sleep for 4.941712 seconds and try again... (tryings = 62, bot id = 7420426900)
2025-06-16 23:31:26,673 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:31:26,675 - aiogram.dispatcher - WARNING - Sleep for 5.042544 seconds and try again... (tryings = 63, bot id = 7420426900)
2025-06-16 23:31:52,768 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:31:52,770 - aiogram.dispatcher - WARNING - Sleep for 4.907175 seconds and try again... (tryings = 64, bot id = 7420426900)
2025-06-16 23:32:18,732 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:32:18,734 - aiogram.dispatcher - WARNING - Sleep for 4.785718 seconds and try again... (tryings = 65, bot id = 7420426900)
2025-06-16 23:32:44,567 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:32:44,568 - aiogram.dispatcher - WARNING - Sleep for 5.042763 seconds and try again... (tryings = 66, bot id = 7420426900)
2025-06-16 23:33:10,659 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:33:10,661 - aiogram.dispatcher - WARNING - Sleep for 5.075673 seconds and try again... (tryings = 67, bot id = 7420426900)
2025-06-16 23:33:36,798 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:33:36,799 - aiogram.dispatcher - WARNING - Sleep for 4.948209 seconds and try again... (tryings = 68, bot id = 7420426900)
2025-06-16 23:34:02,783 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:34:02,784 - aiogram.dispatcher - WARNING - Sleep for 4.819111 seconds and try again... (tryings = 69, bot id = 7420426900)
2025-06-16 23:34:29,399 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:34:29,401 - aiogram.dispatcher - WARNING - Sleep for 5.032910 seconds and try again... (tryings = 70, bot id = 7420426900)
2025-06-16 23:34:55,479 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:34:55,482 - aiogram.dispatcher - WARNING - Sleep for 5.073993 seconds and try again... (tryings = 71, bot id = 7420426900)
2025-06-16 23:35:21,595 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:35:21,597 - aiogram.dispatcher - WARNING - Sleep for 4.879519 seconds and try again... (tryings = 72, bot id = 7420426900)
2025-06-16 23:35:47,529 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:35:47,530 - aiogram.dispatcher - WARNING - Sleep for 5.004581 seconds and try again... (tryings = 73, bot id = 7420426900)
2025-06-16 23:36:13,596 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:36:13,597 - aiogram.dispatcher - WARNING - Sleep for 5.031941 seconds and try again... (tryings = 74, bot id = 7420426900)
2025-06-16 23:36:39,672 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:36:39,673 - aiogram.dispatcher - WARNING - Sleep for 4.989914 seconds and try again... (tryings = 75, bot id = 7420426900)
2025-06-16 23:37:05,710 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:37:05,711 - aiogram.dispatcher - WARNING - Sleep for 5.127803 seconds and try again... (tryings = 76, bot id = 7420426900)
2025-06-16 23:37:31,889 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:37:31,890 - aiogram.dispatcher - WARNING - Sleep for 4.913259 seconds and try again... (tryings = 77, bot id = 7420426900)
2025-06-16 23:37:57,849 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:37:57,850 - aiogram.dispatcher - WARNING - Sleep for 4.867626 seconds and try again... (tryings = 78, bot id = 7420426900)
2025-06-16 23:38:23,782 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:38:23,783 - aiogram.dispatcher - WARNING - Sleep for 4.946562 seconds and try again... (tryings = 79, bot id = 7420426900)
2025-06-16 23:38:49,806 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:38:49,808 - aiogram.dispatcher - WARNING - Sleep for 5.078915 seconds and try again... (tryings = 80, bot id = 7420426900)
2025-06-16 23:39:16,013 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:39:16,014 - aiogram.dispatcher - WARNING - Sleep for 5.023476 seconds and try again... (tryings = 81, bot id = 7420426900)
2025-06-16 23:39:42,087 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:39:42,089 - aiogram.dispatcher - WARNING - Sleep for 4.976634 seconds and try again... (tryings = 82, bot id = 7420426900)
2025-06-16 23:40:08,132 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:40:08,134 - aiogram.dispatcher - WARNING - Sleep for 5.055193 seconds and try again... (tryings = 83, bot id = 7420426900)
2025-06-16 23:40:34,232 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:40:34,233 - aiogram.dispatcher - WARNING - Sleep for 5.051147 seconds and try again... (tryings = 84, bot id = 7420426900)
2025-06-16 23:41:00,328 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:41:00,330 - aiogram.dispatcher - WARNING - Sleep for 4.779981 seconds and try again... (tryings = 85, bot id = 7420426900)
2025-06-16 23:41:26,165 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:41:26,166 - aiogram.dispatcher - WARNING - Sleep for 4.978324 seconds and try again... (tryings = 86, bot id = 7420426900)
2025-06-16 23:41:52,188 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:41:52,190 - aiogram.dispatcher - WARNING - Sleep for 4.946380 seconds and try again... (tryings = 87, bot id = 7420426900)
2025-06-16 23:42:18,188 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:42:18,190 - aiogram.dispatcher - WARNING - Sleep for 5.052780 seconds and try again... (tryings = 88, bot id = 7420426900)
2025-06-16 23:42:44,326 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:42:44,327 - aiogram.dispatcher - WARNING - Sleep for 5.125182 seconds and try again... (tryings = 89, bot id = 7420426900)
2025-06-16 23:43:10,522 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:43:10,523 - aiogram.dispatcher - WARNING - Sleep for 4.939582 seconds and try again... (tryings = 90, bot id = 7420426900)
2025-06-16 23:43:36,511 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:43:36,512 - aiogram.dispatcher - WARNING - Sleep for 4.968098 seconds and try again... (tryings = 91, bot id = 7420426900)
2025-06-16 23:44:02,531 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:44:02,533 - aiogram.dispatcher - WARNING - Sleep for 5.055562 seconds and try again... (tryings = 92, bot id = 7420426900)
2025-06-16 23:44:28,712 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:44:28,714 - aiogram.dispatcher - WARNING - Sleep for 5.015318 seconds and try again... (tryings = 93, bot id = 7420426900)
2025-06-16 23:44:54,798 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:44:54,800 - aiogram.dispatcher - WARNING - Sleep for 4.939316 seconds and try again... (tryings = 94, bot id = 7420426900)
2025-06-16 23:45:20,793 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:45:20,794 - aiogram.dispatcher - WARNING - Sleep for 5.045276 seconds and try again... (tryings = 95, bot id = 7420426900)
2025-06-16 23:45:46,901 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:45:46,903 - aiogram.dispatcher - WARNING - Sleep for 4.966878 seconds and try again... (tryings = 96, bot id = 7420426900)
2025-06-16 23:46:12,954 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:46:12,955 - aiogram.dispatcher - WARNING - Sleep for 5.040367 seconds and try again... (tryings = 97, bot id = 7420426900)
2025-06-16 23:46:39,051 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:46:39,052 - aiogram.dispatcher - WARNING - Sleep for 4.951729 seconds and try again... (tryings = 98, bot id = 7420426900)
2025-06-16 23:47:05,056 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:47:05,057 - aiogram.dispatcher - WARNING - Sleep for 5.045398 seconds and try again... (tryings = 99, bot id = 7420426900)
2025-06-16 23:47:31,148 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:47:31,149 - aiogram.dispatcher - WARNING - Sleep for 5.060380 seconds and try again... (tryings = 100, bot id = 7420426900)
2025-06-16 23:47:57,266 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:47:57,267 - aiogram.dispatcher - WARNING - Sleep for 4.963773 seconds and try again... (tryings = 101, bot id = 7420426900)
2025-06-16 23:48:23,284 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:48:23,286 - aiogram.dispatcher - WARNING - Sleep for 5.219162 seconds and try again... (tryings = 102, bot id = 7420426900)
2025-06-16 23:48:49,578 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:48:49,579 - aiogram.dispatcher - WARNING - Sleep for 5.076363 seconds and try again... (tryings = 103, bot id = 7420426900)
2025-06-16 23:49:15,780 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:49:15,781 - aiogram.dispatcher - WARNING - Sleep for 5.037393 seconds and try again... (tryings = 104, bot id = 7420426900)
2025-06-16 23:49:41,916 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:49:41,917 - aiogram.dispatcher - WARNING - Sleep for 4.908285 seconds and try again... (tryings = 105, bot id = 7420426900)
2025-06-16 23:50:07,882 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:50:07,883 - aiogram.dispatcher - WARNING - Sleep for 4.876187 seconds and try again... (tryings = 106, bot id = 7420426900)
2025-06-16 23:50:33,794 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:50:33,795 - aiogram.dispatcher - WARNING - Sleep for 5.086508 seconds and try again... (tryings = 107, bot id = 7420426900)
2025-06-16 23:50:59,914 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:50:59,915 - aiogram.dispatcher - WARNING - Sleep for 4.922393 seconds and try again... (tryings = 108, bot id = 7420426900)
2025-06-16 23:51:25,905 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:51:25,906 - aiogram.dispatcher - WARNING - Sleep for 4.872798 seconds and try again... (tryings = 109, bot id = 7420426900)
2025-06-16 23:51:51,835 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:51:51,836 - aiogram.dispatcher - WARNING - Sleep for 4.966977 seconds and try again... (tryings = 110, bot id = 7420426900)
2025-06-16 23:52:17,869 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:52:17,871 - aiogram.dispatcher - WARNING - Sleep for 5.080867 seconds and try again... (tryings = 111, bot id = 7420426900)
2025-06-16 23:52:43,989 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:52:43,991 - aiogram.dispatcher - WARNING - Sleep for 4.813512 seconds and try again... (tryings = 112, bot id = 7420426900)
2025-06-16 23:53:09,854 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:53:09,855 - aiogram.dispatcher - WARNING - Sleep for 4.920700 seconds and try again... (tryings = 113, bot id = 7420426900)
2025-06-16 23:53:35,826 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:53:35,827 - aiogram.dispatcher - WARNING - Sleep for 4.831513 seconds and try again... (tryings = 114, bot id = 7420426900)
2025-06-16 23:54:01,717 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:54:01,718 - aiogram.dispatcher - WARNING - Sleep for 4.926413 seconds and try again... (tryings = 115, bot id = 7420426900)
2025-06-16 23:54:27,737 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:54:27,739 - aiogram.dispatcher - WARNING - Sleep for 5.044755 seconds and try again... (tryings = 116, bot id = 7420426900)
2025-06-16 23:54:53,844 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:54:53,845 - aiogram.dispatcher - WARNING - Sleep for 4.954296 seconds and try again... (tryings = 117, bot id = 7420426900)
2025-06-16 23:55:19,851 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:55:19,852 - aiogram.dispatcher - WARNING - Sleep for 5.001667 seconds and try again... (tryings = 118, bot id = 7420426900)
2025-06-16 23:55:45,907 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:55:45,908 - aiogram.dispatcher - WARNING - Sleep for 5.046200 seconds and try again... (tryings = 119, bot id = 7420426900)
2025-06-16 23:56:12,080 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:56:12,082 - aiogram.dispatcher - WARNING - Sleep for 5.022160 seconds and try again... (tryings = 120, bot id = 7420426900)
2025-06-16 23:56:38,148 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:56:38,149 - aiogram.dispatcher - WARNING - Sleep for 5.133547 seconds and try again... (tryings = 121, bot id = 7420426900)
2025-06-16 23:57:04,315 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:57:04,316 - aiogram.dispatcher - WARNING - Sleep for 4.872719 seconds and try again... (tryings = 122, bot id = 7420426900)
2025-06-16 23:57:30,254 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:57:30,255 - aiogram.dispatcher - WARNING - Sleep for 5.005961 seconds and try again... (tryings = 123, bot id = 7420426900)
2025-06-16 23:57:56,311 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:57:56,313 - aiogram.dispatcher - WARNING - Sleep for 5.194203 seconds and try again... (tryings = 124, bot id = 7420426900)
2025-06-16 23:58:22,542 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:58:22,543 - aiogram.dispatcher - WARNING - Sleep for 5.200473 seconds and try again... (tryings = 125, bot id = 7420426900)
2025-06-16 23:58:48,783 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:58:48,785 - aiogram.dispatcher - WARNING - Sleep for 5.024432 seconds and try again... (tryings = 126, bot id = 7420426900)
2025-06-16 23:59:14,865 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:59:14,866 - aiogram.dispatcher - WARNING - Sleep for 5.041380 seconds and try again... (tryings = 127, bot id = 7420426900)
2025-06-16 23:59:40,997 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-16 23:59:40,999 - aiogram.dispatcher - WARNING - Sleep for 4.996703 seconds and try again... (tryings = 128, bot id = 7420426900)
2025-06-17 00:00:07,050 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:00:07,052 - aiogram.dispatcher - WARNING - Sleep for 5.041176 seconds and try again... (tryings = 129, bot id = 7420426900)
2025-06-17 00:00:33,149 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:00:33,150 - aiogram.dispatcher - WARNING - Sleep for 4.940338 seconds and try again... (tryings = 130, bot id = 7420426900)
2025-06-17 00:00:59,150 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:00:59,152 - aiogram.dispatcher - WARNING - Sleep for 5.124903 seconds and try again... (tryings = 131, bot id = 7420426900)
2025-06-17 00:01:25,315 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:01:25,317 - aiogram.dispatcher - WARNING - Sleep for 4.911854 seconds and try again... (tryings = 132, bot id = 7420426900)
2025-06-17 00:01:51,287 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:01:51,288 - aiogram.dispatcher - WARNING - Sleep for 4.829649 seconds and try again... (tryings = 133, bot id = 7420426900)
2025-06-17 00:02:17,172 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:02:17,173 - aiogram.dispatcher - WARNING - Sleep for 4.861787 seconds and try again... (tryings = 134, bot id = 7420426900)
2025-06-17 00:02:43,082 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:02:43,083 - aiogram.dispatcher - WARNING - Sleep for 4.934343 seconds and try again... (tryings = 135, bot id = 7420426900)
2025-06-17 00:03:09,071 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:03:09,072 - aiogram.dispatcher - WARNING - Sleep for 5.010897 seconds and try again... (tryings = 136, bot id = 7420426900)
2025-06-17 00:03:35,142 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:03:35,144 - aiogram.dispatcher - WARNING - Sleep for 5.093703 seconds and try again... (tryings = 137, bot id = 7420426900)
2025-06-17 00:04:01,297 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:04:01,298 - aiogram.dispatcher - WARNING - Sleep for 5.022163 seconds and try again... (tryings = 138, bot id = 7420426900)
2025-06-17 00:04:27,458 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:04:27,460 - aiogram.dispatcher - WARNING - Sleep for 4.904704 seconds and try again... (tryings = 139, bot id = 7420426900)
2025-06-17 00:04:53,422 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:04:53,423 - aiogram.dispatcher - WARNING - Sleep for 5.032926 seconds and try again... (tryings = 140, bot id = 7420426900)
2025-06-17 00:05:19,496 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:05:19,497 - aiogram.dispatcher - WARNING - Sleep for 4.992945 seconds and try again... (tryings = 141, bot id = 7420426900)
2025-06-17 00:05:45,554 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:05:45,555 - aiogram.dispatcher - WARNING - Sleep for 5.067331 seconds and try again... (tryings = 142, bot id = 7420426900)
2025-06-17 00:06:12,144 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:06:12,145 - aiogram.dispatcher - WARNING - Sleep for 4.911193 seconds and try again... (tryings = 143, bot id = 7420426900)
2025-06-17 00:06:38,120 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:06:38,121 - aiogram.dispatcher - WARNING - Sleep for 5.091911 seconds and try again... (tryings = 144, bot id = 7420426900)
2025-06-17 00:07:04,258 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:07:04,259 - aiogram.dispatcher - WARNING - Sleep for 5.128252 seconds and try again... (tryings = 145, bot id = 7420426900)
2025-06-17 00:07:30,427 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:07:30,428 - aiogram.dispatcher - WARNING - Sleep for 4.979573 seconds and try again... (tryings = 146, bot id = 7420426900)
2025-06-17 00:07:56,441 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:07:56,443 - aiogram.dispatcher - WARNING - Sleep for 5.078409 seconds and try again... (tryings = 147, bot id = 7420426900)
2025-06-17 00:08:22,570 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:08:22,571 - aiogram.dispatcher - WARNING - Sleep for 4.905915 seconds and try again... (tryings = 148, bot id = 7420426900)
2025-06-17 00:08:48,516 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:08:48,517 - aiogram.dispatcher - WARNING - Sleep for 4.970168 seconds and try again... (tryings = 149, bot id = 7420426900)
2025-06-17 00:09:14,541 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:09:14,542 - aiogram.dispatcher - WARNING - Sleep for 4.964168 seconds and try again... (tryings = 150, bot id = 7420426900)
2025-06-17 00:09:40,630 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:09:40,631 - aiogram.dispatcher - WARNING - Sleep for 4.863018 seconds and try again... (tryings = 151, bot id = 7420426900)
2025-06-17 00:10:06,540 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:10:06,542 - aiogram.dispatcher - WARNING - Sleep for 5.075855 seconds and try again... (tryings = 152, bot id = 7420426900)
2025-06-17 00:10:32,666 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:10:32,667 - aiogram.dispatcher - WARNING - Sleep for 4.901276 seconds and try again... (tryings = 153, bot id = 7420426900)
2025-06-17 00:10:58,609 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:10:58,610 - aiogram.dispatcher - WARNING - Sleep for 5.001298 seconds and try again... (tryings = 154, bot id = 7420426900)
2025-06-17 00:11:24,657 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:11:24,659 - aiogram.dispatcher - WARNING - Sleep for 4.816492 seconds and try again... (tryings = 155, bot id = 7420426900)
2025-06-17 00:11:50,503 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:11:50,504 - aiogram.dispatcher - WARNING - Sleep for 5.118318 seconds and try again... (tryings = 156, bot id = 7420426900)
2025-06-17 00:12:16,681 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:12:16,683 - aiogram.dispatcher - WARNING - Sleep for 4.851992 seconds and try again... (tryings = 157, bot id = 7420426900)
2025-06-17 00:12:42,573 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-06-17 00:12:42,574 - aiogram.dispatcher - WARNING - Sleep for 5.110382 seconds and try again... (tryings = 158, bot id = 7420426900)
